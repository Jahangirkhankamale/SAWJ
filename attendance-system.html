<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AttendancePro - Smart Attendance Management System</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233B82F6'><path d='M22 10L12 5L2 10L12 15L22 10Z'/><path d='M6 12V17C6 18.1046 8.68629 21 12 21C15.3137 21 18 18.1046 18 17V12'/></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Custom Tailwind Configuration */
        :root {
            --primary-50: #eff6ff;
            --primary-100: #dbeafe;
            --primary-200: #bfdbfe;
            --primary-300: #93c5fd;
            --primary-400: #60a5fa;
            --primary-500: #3b82f6;
            --primary-600: #2563eb;
            --primary-700: #1d4ed8;
            --primary-800: #1e40af;
            --primary-900: #1e3a8a;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .fade-in { animation: fadeIn 0.3s ease-out; }
        .slide-in { animation: slideIn 0.3s ease-out; }
        .pulse { animation: pulse 2s infinite; }
        .spin { animation: spin 1s linear infinite; }

        /* Custom Styles */
        .sidebar {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .sidebar.collapsed {
            width: 4rem;
        }

        .nav-link {
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .nav-link:hover::before {
            left: 100%;
        }

        .card {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Dark mode styles */
        .dark {
            color-scheme: dark;
        }

        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                z-index: 50;
                height: 100vh;
                width: 16rem;
            }
            
            .sidebar.active {
                left: 0;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #6b7280;
        }

        /* Notification styles */
        .notification {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(100%);
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Modal styles */
        .modal {
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: scale(0.9) translateY(-20px);
            opacity: 0;
        }

        .modal.show .modal-content {
            transform: scale(1) translateY(0);
            opacity: 1;
        }

        /* Loading spinner */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-500);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        /* QR Code styles */
        .qr-scanner {
            border: 2px dashed var(--primary-500);
            border-radius: 12px;
            background: var(--primary-50);
        }

        /* Biometric styles */
        .biometric-scanner {
            background: radial-gradient(circle, rgba(59,130,246,0.1) 0%, rgba(59,130,246,0.05) 70%);
            border: 2px solid var(--primary-200);
        }

        /* Face recognition styles */
        .face-recognition {
            background: linear-gradient(45deg, rgba(16,185,129,0.1) 0%, rgba(5,150,105,0.1) 100%);
            border: 2px solid #10b981;
        }

        /* GPS styles */
        .gps-indicator {
            background: linear-gradient(45deg, rgba(245,158,11,0.1) 0%, rgba(217,119,6,0.1) 100%);
            border: 2px solid #f59e0b;
        }

        /* Status badges */
        .status-present { @apply bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200; }
        .status-absent { @apply bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200; }
        .status-late { @apply bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200; }
        .status-excused { @apply bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200; }

        /* Print styles */
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white !important; color: black !important; }
        }

        /* Accessibility */
        .focus-visible:focus {
            outline: 2px solid var(--primary-500);
            outline-offset: 2px;
        }

        /* High contrast mode */
        @media (prefers-contrast: high) {
            .card {
                border: 2px solid currentColor;
            }
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 font-sans transition-colors duration-300">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center z-50">
        <div class="text-center text-white">
            <div class="w-16 h-16 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <h2 class="text-2xl font-bold mb-2">AttendancePro</h2>
            <p class="text-blue-100">Loading Smart Attendance System...</p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-900 dark:to-gray-800 flex items-center justify-center p-4 hidden">
        <div class="w-full max-w-md">
            <!-- Logo and Title -->
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl shadow-lg mb-4">
                    <i class="fas fa-graduation-cap text-2xl text-white"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-900 dark:text-white">AttendancePro</h1>
                <p class="text-gray-600 dark:text-gray-400 mt-2">Smart Attendance Management System</p>
            </div>

            <!-- Login Form -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-200 dark:border-gray-700">
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email Address</label>
                        <div class="relative">
                            <i class="fas fa-envelope absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="email" id="loginEmail" class="w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Enter your email" value="admin@school.edu" required>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Password</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="password" id="loginPassword" class="w-full pl-10 pr-12 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Enter your password" value="password123" required>
                            <button type="button" id="togglePassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <!-- 2FA Code (hidden by default) -->
                    <div id="twoFactorSection" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">2FA Code</label>
                        <div class="relative">
                            <i class="fas fa-shield-alt absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" id="twoFactorCode" class="w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Enter 6-digit code (use 123456 for demo)" maxlength="6">
                        </div>
                    </div>

                    <button type="submit" id="loginBtn" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl">
                        <span>Sign In</span>
                        <div id="loginSpinner" class="loading-spinner hidden"></div>
                    </button>
                </form>

                <!-- Demo Accounts -->
                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Demo Accounts:</p>
                    <div class="grid grid-cols-2 gap-2">
                        <button class="demo-account text-xs bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-3 rounded-lg transition-colors" data-email="admin@school.edu" data-role="Administrator">Admin</button>
                        <button class="demo-account text-xs bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-3 rounded-lg transition-colors" data-email="teacher@school.edu" data-role="Teacher">Teacher</button>
                        <button class="demo-account text-xs bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-3 rounded-lg transition-colors" data-email="student@school.edu" data-role="Student">Student</button>
                        <button class="demo-account text-xs bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-3 rounded-lg transition-colors" data-email="parent@school.edu" data-role="Parent">Parent</button>
                    </div>
                </div>

                <!-- Features -->
                <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <p class="text-xs text-gray-500 dark:text-gray-400 text-center mb-3">Features included:</p>
                    <div class="text-xs text-gray-600 dark:text-gray-400 space-y-1">
                        <div class="flex items-center justify-center space-x-4">
                            <span>‚Ä¢ QR Code Attendance</span>
                            <span>‚Ä¢ GPS Verification</span>
                        </div>
                        <div class="flex items-center justify-center space-x-4">
                            <span>‚Ä¢ Face Recognition</span>
                            <span>‚Ä¢ Biometric Support</span>
                        </div>
                        <div class="flex items-center justify-center space-x-4">
                            <span>‚Ä¢ AI Analytics</span>
                            <span>‚Ä¢ Multi-language</span>
                        </div>
                        <div class="flex items-center justify-center space-x-4">
                            <span>‚Ä¢ PDF Reports</span>
                            <span>‚Ä¢ Real-time Sync</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="flex min-h-screen hidden">
        <!-- Mobile menu button -->
        <button class="md:hidden fixed top-4 left-4 z-50 bg-blue-600 text-white p-2 rounded-lg shadow-lg hover:bg-blue-700 transition-colors no-print" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Sidebar -->
        <div class="sidebar w-64 bg-gradient-to-b from-blue-800 to-purple-900 text-white p-4 flex flex-col shadow-xl no-print" id="sidebar">
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center">
                    <i class="fas fa-graduation-cap text-2xl mr-3"></i>
                    <div id="sidebarTitle">
                        <h1 class="text-xl font-bold">AttendancePro</h1>
                        <p class="text-xs text-blue-200">Smart System</p>
                    </div>
                </div>
                <button class="md:hidden text-white hover:text-gray-300 transition" id="closeMenuBtn">
                    <i class="fas fa-times"></i>
                </button>
                <button class="hidden md:block text-white hover:text-gray-300 transition" id="collapseSidebarBtn">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>

            <nav class="flex-1">
                <ul class="space-y-2" id="navigationMenu">
                    <!-- Navigation items will be populated by JavaScript -->
                </ul>
            </nav>

            <!-- User Profile -->
            <div class="mt-auto pt-4 border-t border-blue-700">
                <div class="flex items-center p-2 rounded-lg hover:bg-blue-700 transition cursor-pointer" id="userProfile">
                    <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center mr-3">
                        <i class="fas fa-user"></i>
                    </div>
                    <div id="userInfo">
                        <p class="text-sm font-medium" id="userName">Loading...</p>
                        <p class="text-xs text-blue-300" id="userRole">Loading...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4 no-print">
                <div class="flex items-center justify-between">
                    <!-- Left side - Search -->
                    <div class="flex items-center space-x-4 flex-1 max-w-md">
                        <div class="relative w-full">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                            <input type="text" id="globalSearch" placeholder="Search students, classes, reports..." class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                    </div>

                    <!-- Right side - Actions -->
                    <div class="flex items-center space-x-4">
                        <!-- Current Time -->
                        <div class="hidden sm:block text-sm text-gray-600 dark:text-gray-400 font-mono bg-gray-100 dark:bg-gray-700 px-3 py-1.5 rounded-lg">
                            <span id="currentTime">--:--:--</span>
                        </div>

                        <!-- Language Selector -->
                        <div class="relative">
                            <button id="languageBtn" class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200">
                                <i class="fas fa-globe w-5 h-5"></i>
                            </button>
                            <div id="languageMenu" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-50 hidden">
                                <button class="language-option w-full flex items-center space-x-3 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-lang="en">
                                    <span class="text-lg">üá∫üá∏</span>
                                    <span>English</span>
                                </button>
                                <button class="language-option w-full flex items-center space-x-3 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-lang="es">
                                    <span class="text-lg">üá™üá∏</span>
                                    <span>Espa√±ol</span>
                                </button>
                                <button class="language-option w-full flex items-center space-x-3 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-lang="fr">
                                    <span class="text-lg">üá´üá∑</span>
                                    <span>Fran√ßais</span>
                                </button>
                                <button class="language-option w-full flex items-center space-x-3 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-lang="de">
                                    <span class="text-lg">üá©üá™</span>
                                    <span>Deutsch</span>
                                </button>
                                <button class="language-option w-full flex items-center space-x-3 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-lang="hi">
                                    <span class="text-lg">üáÆüá≥</span>
                                    <span>‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</span>
                                </button>
                                <button class="language-option w-full flex items-center space-x-3 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-lang="ar">
                                    <span class="text-lg">üá∏üá¶</span>
                                    <span>ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</span>
                                </button>
                            </div>
                        </div>

                        <!-- Theme Selector -->
                        <div class="relative">
                            <button id="themeBtn" class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200">
                                <i class="fas fa-sun w-5 h-5" id="themeIcon"></i>
                            </button>
                            <div id="themeMenu" class="absolute right-0 mt-2 w-32 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-50 hidden">
                                <button class="theme-option w-full flex items-center space-x-2 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-theme="light">
                                    <i class="fas fa-sun w-4 h-4"></i>
                                    <span>Light</span>
                                </button>
                                <button class="theme-option w-full flex items-center space-x-2 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-theme="dark">
                                    <i class="fas fa-moon w-4 h-4"></i>
                                    <span>Dark</span>
                                </button>
                                <button class="theme-option w-full flex items-center space-x-2 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-theme="system">
                                    <i class="fas fa-desktop w-4 h-4"></i>
                                    <span>System</span>
                                </button>
                            </div>
                        </div>

                        <!-- Notifications -->
                        <button id="notificationBtn" class="relative p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200">
                            <i class="fas fa-bell w-5 h-5"></i>
                            <span id="notificationBadge" class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full flex items-center justify-center hidden">
                                <span class="w-1.5 h-1.5 bg-white rounded-full"></span>
                            </span>
                        </button>

                        <!-- User Menu -->
                        <div class="relative">
                            <button id="userMenuBtn" class="flex items-center space-x-3 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200">
                                <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-purple-600 rounded-full flex items-center justify-center">
                                    <span class="text-sm font-medium text-white" id="userAvatar">A</span>
                                </div>
                                <div class="hidden sm:block text-left">
                                    <p class="text-sm font-medium text-gray-900 dark:text-white" id="headerUserName">Admin User</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400" id="headerUserRole">Administrator</p>
                                </div>
                            </button>

                            <div id="userMenu" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-50 hidden">
                                <div class="px-4 py-2 border-b border-gray-200 dark:border-gray-700">
                                    <p class="text-sm font-medium text-gray-900 dark:text-white" id="menuUserName">Admin User</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400" id="menuUserEmail">admin@school.edu</p>
                                </div>
                                <button class="w-full flex items-center space-x-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                    <i class="fas fa-user w-4 h-4"></i>
                                    <span>Profile</span>
                                </button>
                                <button id="enable2FABtn" class="w-full flex items-center space-x-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                    <i class="fas fa-shield-alt w-4 h-4"></i>
                                    <span>Enable 2FA</span>
                                </button>
                                <button class="w-full flex items-center space-x-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                    <i class="fas fa-cog w-4 h-4"></i>
                                    <span>Settings</span>
                                </button>
                                <div class="border-t border-gray-200 dark:border-gray-700 mt-2 pt-2">
                                    <button id="logoutBtn" class="w-full flex items-center space-x-2 px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors">
                                        <i class="fas fa-sign-out-alt w-4 h-4"></i>
                                        <span>Logout</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Content Area -->
            <main class="flex-1 overflow-auto p-6" id="mainContent">
                <!-- Content will be dynamically loaded here -->
            </main>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- 2FA Setup Modal -->
    <div id="twoFactorModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md m-4 modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white">Setup Two-Factor Authentication</h3>
                    <button id="close2FAModal" class="text-gray-400 hover:text-gray-600 transition">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="text-center">
                    <div class="w-48 h-48 mx-auto mb-4 bg-white p-4 rounded-lg shadow-inner" id="qrCodeContainer">
                        <!-- QR Code will be generated here -->
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                        Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.)
                    </p>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Enter verification code</label>
                            <input type="text" id="verify2FACode" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white text-center text-lg tracking-widest" placeholder="000000" maxlength="6">
                        </div>
                        <div class="flex space-x-3">
                            <button id="cancel2FABtn" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition">
                                Cancel
                            </button>
                            <button id="verify2FABtn" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                Verify & Enable
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Scanner Modal -->
    <div id="qrScannerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md m-4 modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white">QR Code Scanner</h3>
                    <button id="closeQRScannerModal" class="text-gray-400 hover:text-gray-600 transition">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="text-center">
                    <div class="qr-scanner w-full h-64 flex items-center justify-center mb-4">
                        <div class="text-center">
                            <i class="fas fa-qrcode text-6xl text-blue-500 mb-4"></i>
                            <p class="text-gray-600 dark:text-gray-400">Position QR code within the frame</p>
                            <button id="startQRScan" class="mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                <i class="fas fa-camera mr-2"></i>
                                Start Camera
                            </button>
                        </div>
                    </div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">
                        Scan the attendance QR code to mark your presence
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Face Recognition Modal -->
    <div id="faceRecognitionModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md m-4 modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white">Face Recognition</h3>
                    <button id="closeFaceRecognitionModal" class="text-gray-400 hover:text-gray-600 transition">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="text-center">
                    <div class="face-recognition w-full h-64 flex items-center justify-center mb-4 rounded-lg">
                        <div class="text-center">
                            <i class="fas fa-user-circle text-6xl text-green-500 mb-4"></i>
                            <p class="text-gray-600 dark:text-gray-400 mb-2">Position your face in the center</p>
                            <div class="w-32 h-32 border-4 border-green-500 rounded-full mx-auto mb-4 flex items-center justify-center">
                                <i class="fas fa-user text-3xl text-green-500"></i>
                            </div>
                            <button id="startFaceRecognition" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                                <i class="fas fa-camera mr-2"></i>
                                Start Recognition
                            </button>
                        </div>
                    </div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">
                        Look directly at the camera for face recognition
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Biometric Scanner Modal -->
    <div id="biometricModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md m-4 modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white">Biometric Scanner</h3>
                    <button id="closeBiometricModal" class="text-gray-400 hover:text-gray-600 transition">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="text-center">
                    <div class="biometric-scanner w-full h-64 flex items-center justify-center mb-4 rounded-lg">
                        <div class="text-center">
                            <i class="fas fa-fingerprint text-6xl text-blue-500 mb-4"></i>
                            <p class="text-gray-600 dark:text-gray-400 mb-4">Place your finger on the scanner</p>
                            <div class="w-24 h-24 border-4 border-blue-500 rounded-full mx-auto mb-4 flex items-center justify-center">
                                <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center">
                                    <i class="fas fa-fingerprint text-2xl text-blue-500"></i>
                                </div>
                            </div>
                            <button id="startBiometricScan" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                <i class="fas fa-fingerprint mr-2"></i>
                                Start Scan
                            </button>
                        </div>
                    </div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">
                        Press and hold your finger on the scanner
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- GPS Location Modal -->
    <div id="gpsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md m-4 modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white">GPS Verification</h3>
                    <button id="closeGPSModal" class="text-gray-400 hover:text-gray-600 transition">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="text-center">
                    <div class="gps-indicator w-full h-64 flex items-center justify-center mb-4 rounded-lg">
                        <div class="text-center">
                            <i class="fas fa-map-marker-alt text-6xl text-yellow-500 mb-4"></i>
                            <p class="text-gray-600 dark:text-gray-400 mb-4">Verifying your location...</p>
                            <div class="relative w-32 h-32 mx-auto mb-4">
                                <div class="absolute inset-0 border-4 border-yellow-200 rounded-full"></div>
                                <div class="absolute inset-2 border-4 border-yellow-400 rounded-full animate-ping"></div>
                                <div class="absolute inset-6 bg-yellow-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-crosshairs text-white text-xl"></i>
                                </div>
                            </div>
                            <button id="enableGPS" class="px-6 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition">
                                <i class="fas fa-location-arrow mr-2"></i>
                                Enable Location
                            </button>
                        </div>
                    </div>
                    <div id="locationInfo" class="text-sm text-gray-500 dark:text-gray-400 hidden">
                        <p>Location: <span id="currentLocation">Detecting...</span></p>
                        <p>Distance from school: <span id="distanceFromSchool">Calculating...</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Generic Modal -->
    <div id="genericModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md m-4 modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white" id="genericModalTitle">Modal Title</h3>
                    <button id="closeGenericModal" class="text-gray-400 hover:text-gray-600 transition">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div id="genericModalContent">
                    <!-- Dynamic content will be inserted here -->
                </div>
                <div class="mt-6 flex justify-end space-x-3" id="genericModalActions">
                    <button id="genericModalCancel" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition">
                        Cancel
                    </button>
                    <button id="genericModalConfirm" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div id="successNotification" class="notification fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg flex items-center z-50">
        <i class="fas fa-check-circle mr-3 text-xl"></i>
        <span id="successMessage">Operation completed successfully!</span>
    </div>

    <div id="errorNotification" class="notification fixed top-4 right-4 bg-red-500 text-white px-6 py-4 rounded-lg shadow-lg flex items-center z-50">
        <i class="fas fa-exclamation-circle mr-3 text-xl"></i>
        <span id="errorMessage">An error occurred!</span>
    </div>

    <div id="infoNotification" class="notification fixed top-4 right-4 bg-blue-500 text-white px-6 py-4 rounded-lg shadow-lg flex items-center z-50">
        <i class="fas fa-info-circle mr-3 text-xl"></i>
        <span id="infoMessage">Information message!</span>
    </div>

    <div id="warningNotification" class="notification fixed top-4 right-4 bg-yellow-500 text-white px-6 py-4 rounded-lg shadow-lg flex items-center z-50">
        <i class="fas fa-exclamation-triangle mr-3 text-xl"></i>
        <span id="warningMessage">Warning message!</span>
    </div>

    <script>
        // Application State Management
        class AttendanceApp {
            constructor() {
                this.currentUser = null;
                this.currentTheme = 'system';
                this.currentLanguage = 'en';
                this.sidebarCollapsed = false;
                this.currentSection = 'dashboard';
                this.data = {
                    users: [
                        { id: 1, email: 'admin@school.edu', password: 'password123', name: 'System Administrator', role: 'admin', is2FAEnabled: false, permissions: ['all'] },
                        { id: 2, email: 'teacher@school.edu', password: 'password123', name: 'John Smith', role: 'teacher', is2FAEnabled: false, classId: 1, permissions: ['attendance:read', 'attendance:write', 'students:read'] },
                        { id: 3, email: 'student@school.edu', password: 'password123', name: 'Alice Johnson', role: 'student', is2FAEnabled: false, classId: 1, permissions: ['attendance:read'] },
                        { id: 4, email: 'parent@school.edu', password: 'password123', name: 'Robert Johnson', role: 'parent', is2FAEnabled: false, studentIds: [3], permissions: ['attendance:read'] }
                    ],
                    classes: [
                        { id: 1, name: 'Grade 10 - Section A', section: 'A', grade: '10', subjects: ['Mathematics', 'Physics', 'Chemistry', 'English', 'Biology'], teacherId: 2, students: [1, 2, 3, 4] },
                        { id: 2, name: 'Grade 11 - Science', section: 'Science', grade: '11', subjects: ['Advanced Math', 'Physics', 'Chemistry', 'Biology'], teacherId: 2, students: [5, 6] }
                    ],
                    students: [
                        { id: 1, rollNo: '2024001', name: 'Alice Johnson', email: 'alice@student.edu', classId: 1, parentIds: [4], isActive: true },
                        { id: 2, rollNo: '2024002', name: 'Bob Smith', email: 'bob@student.edu', classId: 1, parentIds: [], isActive: true },
                        { id: 3, rollNo: '2024003', name: 'Carol Davis', email: 'carol@student.edu', classId: 1, parentIds: [], isActive: true },
                        { id: 4, rollNo: '2024004', name: 'David Wilson', email: 'david@student.edu', classId: 1, parentIds: [], isActive: true },
                        { id: 5, rollNo: '2024005', name: 'Eva Brown', email: 'eva@student.edu', classId: 2, parentIds: [], isActive: true },
                        { id: 6, rollNo: '2024006', name: 'Frank Miller', email: 'frank@student.edu', classId: 2, parentIds: [], isActive: true }
                    ],
                    attendance: [],
                    settings: {
                        institutionName: 'Demo Educational Institute',
                        timeZone: 'UTC',
                        notificationsEnabled: true,
                        autoMarkThreshold: 15,
                        minimumAttendancePercentage: 75,
                        allowLateEntry: true,
                        requireGPSVerification: false,
                        enableFaceRecognition: false,
                        enableQRCode: true
                    }
                };
                
                this.translations = {
                    en: {
                        dashboard: 'Dashboard',
                        attendance: 'Take Attendance',
                        myAttendance: 'My Attendance',
                        childAttendance: 'Child Attendance',
                        classes: 'Manage Classes',
                        students: 'Manage Students',
                        reports: 'Reports & Analytics',
                        leaveRequests: 'Leave Requests',
                        notifications: 'Notifications',
                        qrScanner: 'QR Scanner',
                        faceRecognition: 'Face Recognition',
                        biometric: 'Biometric',
                        gpsVerification: 'GPS Verification',
                        security: 'Security',
                        settings: 'Settings',
                        welcome: 'Welcome back',
                        todaySessions: "Today's Sessions",
                        totalClasses: 'Total Classes',
                        totalStudents: 'Total Students',
                        avgAttendance: 'Avg. Attendance',
                        present: 'Present',
                        absent: 'Absent',
                        late: 'Late',
                        excused: 'Excused'
                    },
                    es: {
                        dashboard: 'Panel de Control',
                        attendance: 'Tomar Asistencia',
                        myAttendance: 'Mi Asistencia',
                        childAttendance: 'Asistencia del Ni√±o',
                        classes: 'Gestionar Clases',
                        students: 'Gestionar Estudiantes',
                        reports: 'Informes y An√°lisis',
                        leaveRequests: 'Solicitudes de Permiso',
                        notifications: 'Notificaciones',
                        qrScanner: 'Esc√°ner QR',
                        faceRecognition: 'Reconocimiento Facial',
                        biometric: 'Biom√©trico',
                        gpsVerification: 'Verificaci√≥n GPS',
                        security: 'Seguridad',
                        settings: 'Configuraci√≥n',
                        welcome: 'Bienvenido de nuevo',
                        todaySessions: 'Sesiones de Hoy',
                        totalClasses: 'Total de Clases',
                        totalStudents: 'Total de Estudiantes',
                        avgAttendance: 'Asistencia Promedio',
                        present: 'Presente',
                        absent: 'Ausente',
                        late: 'Tarde',
                        excused: 'Justificado'
                    },
                    fr: {
                        dashboard: 'Tableau de Bord',
                        attendance: 'Prendre les Pr√©sences',
                        myAttendance: 'Mes Pr√©sences',
                        childAttendance: 'Pr√©sences de l\'Enfant',
                        classes: 'G√©rer les Classes',
                        students: 'G√©rer les √âtudiants',
                        reports: 'Rapports et Analyses',
                        leaveRequests: 'Demandes de Cong√©',
                        notifications: 'Notifications',
                        qrScanner: 'Scanner QR',
                        faceRecognition: 'Reconnaissance Faciale',
                        biometric: 'Biom√©trique',
                        gpsVerification: 'V√©rification GPS',
                        security: 'S√©curit√©',
                        settings: 'Param√®tres',
                        welcome: 'Bon retour',
                        todaySessions: 'Sessions d\'Aujourd\'hui',
                        totalClasses: 'Total des Classes',
                        totalStudents: 'Total des √âtudiants',
                        avgAttendance: 'Pr√©sence Moyenne',
                        present: 'Pr√©sent',
                        absent: 'Absent',
                        late: 'En Retard',
                        excused: 'Excus√©'
                    },
                    de: {
                        dashboard: 'Dashboard',
                        attendance: 'Anwesenheit Erfassen',
                        myAttendance: 'Meine Anwesenheit',
                        childAttendance: 'Kind Anwesenheit',
                        classes: 'Klassen Verwalten',
                        students: 'Sch√ºler Verwalten',
                        reports: 'Berichte & Analysen',
                        leaveRequests: 'Urlaubsantr√§ge',
                        notifications: 'Benachrichtigungen',
                        qrScanner: 'QR Scanner',
                        faceRecognition: 'Gesichtserkennung',
                        biometric: 'Biometrisch',
                        gpsVerification: 'GPS Verifizierung',
                        security: 'Sicherheit',
                        settings: 'Einstellungen',
                        welcome: 'Willkommen zur√ºck',
                        todaySessions: 'Heutige Sitzungen',
                        totalClasses: 'Gesamte Klassen',
                        totalStudents: 'Gesamte Sch√ºler',
                        avgAttendance: 'Durchschn. Anwesenheit',
                        present: 'Anwesend',
                        absent: 'Abwesend',
                        late: 'Versp√§tet',
                        excused: 'Entschuldigt'
                    },
                    hi: {
                        dashboard: '‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°',
                        attendance: '‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§≤‡•á‡§Ç',
                        myAttendance: '‡§Æ‡•á‡§∞‡•Ä ‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                        childAttendance: '‡§¨‡§ö‡•ç‡§ö‡•á ‡§ï‡•Ä ‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                        classes: '‡§ï‡§ï‡•ç‡§∑‡§æ‡§è‡§Ç ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
                        students: '‡§õ‡§æ‡§§‡•ç‡§∞ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
                        reports: '‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§î‡§∞ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£',
                        leaveRequests: '‡§õ‡•Å‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß',
                        notifications: '‡§∏‡•Ç‡§ö‡§®‡§æ‡§è‡§Ç',
                        qrScanner: 'QR ‡§∏‡•ç‡§ï‡•à‡§®‡§∞',
                        faceRecognition: '‡§ö‡•á‡§π‡§∞‡§æ ‡§™‡§π‡§ö‡§æ‡§®',
                        biometric: '‡§¨‡§æ‡§Ø‡•ã‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï',
                        gpsVerification: 'GPS ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§®',
                        security: '‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ',
                        settings: '‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏',
                        welcome: '‡§µ‡§æ‡§™‡§∏‡•Ä ‡§™‡§∞ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§',
                        todaySessions: '‡§Ü‡§ú ‡§ï‡•á ‡§∏‡§§‡•ç‡§∞',
                        totalClasses: '‡§ï‡•Å‡§≤ ‡§ï‡§ï‡•ç‡§∑‡§æ‡§è‡§Ç',
                        totalStudents: '‡§ï‡•Å‡§≤ ‡§õ‡§æ‡§§‡•ç‡§∞',
                        avgAttendance: '‡§î‡§∏‡§§ ‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                        present: '‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§',
                        absent: '‡§Ö‡§®‡•Å‡§™‡§∏‡•ç‡§•‡§ø‡§§',
                        late: '‡§¶‡•á‡§∞ ‡§∏‡•á',
                        excused: '‡§Æ‡§æ‡§´‡§º'
                    },
                    ar: {
                        dashboard: 'ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ',
                        attendance: 'ÿ£ÿÆÿ∞ ÿßŸÑÿ≠ÿ∂Ÿàÿ±',
                        myAttendance: 'ÿ≠ÿ∂Ÿàÿ±Ÿä',
                        childAttendance: 'ÿ≠ÿ∂Ÿàÿ± ÿßŸÑÿ∑ŸÅŸÑ',
                        classes: 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÅÿµŸàŸÑ',
                        students: 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∑ŸÑÿßÿ®',
                        reports: 'ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ± ŸàÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™',
                        leaveRequests: 'ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿ©',
                        notifications: 'ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™',
                        qrScanner: 'ŸÖÿßÿ≥ÿ≠ QR',
                        faceRecognition: 'ÿßŸÑÿ™ÿπÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑŸàÿ¨Ÿá',
                        biometric: 'ÿ®ŸäŸàŸÖÿ™ÿ±Ÿä',
                        gpsVerification: 'ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ GPS',
                        security: 'ÿßŸÑÿ£ŸÖÿßŸÜ',
                        settings: 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
                        welcome: 'ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ÿπŸàÿØÿ™ŸÉ',
                        todaySessions: 'ÿ¨ŸÑÿ≥ÿßÿ™ ÿßŸÑŸäŸàŸÖ',
                        totalClasses: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÅÿµŸàŸÑ',
                        totalStudents: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ∑ŸÑÿßÿ®',
                        avgAttendance: 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ≠ÿ∂Ÿàÿ±',
                        present: 'ÿ≠ÿßÿ∂ÿ±',
                        absent: 'ÿ∫ÿßÿ¶ÿ®',
                        late: 'ŸÖÿ™ÿ£ÿÆÿ±',
                        excused: 'ŸÖÿπÿ∞Ÿàÿ±'
                    }
                };

                this.init();
            }

            init() {
                this.loadFromStorage();
                this.generateSampleAttendance();
                this.setupEventListeners();
                this.updateTime();
                this.applyTheme();
                this.showLoadingScreen();
            }

            loadFromStorage() {
                const savedData = localStorage.getItem('attendanceAppData');
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    this.data = { ...this.data, ...parsed };
                }

                const savedUser = localStorage.getItem('attendanceCurrentUser');
                if (savedUser) {
                    this.currentUser = JSON.parse(savedUser);
                }

                const savedTheme = localStorage.getItem('attendanceTheme');
                if (savedTheme) {
                    this.currentTheme = savedTheme;
                }

                const savedLanguage = localStorage.getItem('attendanceLanguage');
                if (savedLanguage) {
                    this.currentLanguage = savedLanguage;
                }

                const savedSidebar = localStorage.getItem('attendanceSidebarCollapsed');
                if (savedSidebar) {
                    this.sidebarCollapsed = JSON.parse(savedSidebar);
                }
            }

            saveToStorage() {
                localStorage.setItem('attendanceAppData', JSON.stringify(this.data));
                if (this.currentUser) {
                    localStorage.setItem('attendanceCurrentUser', JSON.stringify(this.currentUser));
                }
                localStorage.setItem('attendanceTheme', this.currentTheme);
                localStorage.setItem('attendanceLanguage', this.currentLanguage);
                localStorage.setItem('attendanceSidebarCollapsed', JSON.stringify(this.sidebarCollapsed));
            }

            generateSampleAttendance() {
                if (this.data.attendance.length > 0) return;

                const today = new Date();
                const dates = [];
                
                // Generate last 30 days of sample data
                for (let i = 0; i < 30; i++) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    dates.push(this.formatDate(date));
                }

                let id = 1;
                dates.forEach(date => {
                    this.data.classes.forEach(classObj => {
                        const subject = classObj.subjects[Math.floor(Math.random() * classObj.subjects.length)];
                        const classStudents = this.data.students.filter(s => s.classId === classObj.id);
                        
                        const records = classStudents.map(student => ({
                            studentId: student.id,
                            status: Math.random() > 0.15 ? 'present' : Math.random() > 0.5 ? 'absent' : 'late',
                            timestamp: new Date(date + 'T09:00:00'),
                            method: 'manual'
                        }));

                        this.data.attendance.push({
                            id: id++,
                            classId: classObj.id,
                            subject: subject,
                            date: date,
                            period: 1,
                            teacherId: classObj.teacherId,
                            records: records,
                            method: 'manual',
                            createdAt: new Date(date),
                            updatedAt: new Date(date)
                        });
                    });
                });

                this.saveToStorage();
            }

            setupEventListeners() {
                // Login form
                document.getElementById('loginForm').addEventListener('submit', (e) => this.handleLogin(e));
                document.getElementById('togglePassword').addEventListener('click', () => this.togglePasswordVisibility());
                
                // Demo account buttons
                document.querySelectorAll('.demo-account').forEach(btn => {
                    btn.addEventListener('click', (e) => this.selectDemoAccount(e));
                });

                // Mobile menu
                document.getElementById('mobileMenuBtn').addEventListener('click', () => this.toggleMobileMenu());
                document.getElementById('closeMenuBtn').addEventListener('click', () => this.toggleMobileMenu());

                // Sidebar collapse
                document.getElementById('collapseSidebarBtn').addEventListener('click', () => this.toggleSidebar());

                // Theme and language
                document.getElementById('themeBtn').addEventListener('click', () => this.toggleThemeMenu());
                document.getElementById('languageBtn').addEventListener('click', () => this.toggleLanguageMenu());
                
                document.querySelectorAll('.theme-option').forEach(btn => {
                    btn.addEventListener('click', (e) => this.setTheme(e.target.closest('.theme-option').dataset.theme));
                });
                
                document.querySelectorAll('.language-option').forEach(btn => {
                    btn.addEventListener('click', (e) => this.setLanguage(e.target.closest('.language-option').dataset.lang));
                });

                // User menu
                document.getElementById('userMenuBtn').addEventListener('click', () => this.toggleUserMenu());
                document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
                document.getElementById('enable2FABtn').addEventListener('click', () => this.show2FASetup());

                // Notifications
                document.getElementById('notificationBtn').addEventListener('click', () => this.showNotifications());

                // Global search
                document.getElementById('globalSearch').addEventListener('input', (e) => this.handleGlobalSearch(e.target.value));

                // Modal close buttons
                document.querySelectorAll('[id$="Modal"] button[id^="close"]').forEach(btn => {
                    btn.addEventListener('click', (e) => this.closeModal(e.target.closest('.modal')));
                });

                // 2FA Modal
                document.getElementById('verify2FABtn').addEventListener('click', () => this.verify2FA());
                document.getElementById('cancel2FABtn').addEventListener('click', () => this.closeModal(document.getElementById('twoFactorModal')));

                // QR Scanner
                document.getElementById('startQRScan').addEventListener('click', () => this.startQRScanner());

                // Face Recognition
                document.getElementById('startFaceRecognition').addEventListener('click', () => this.startFaceRecognition());

                // Biometric
                document.getElementById('startBiometricScan').addEventListener('click', () => this.startBiometricScan());

                // GPS
                document.getElementById('enableGPS').addEventListener('click', () => this.enableGPS());

                // Close dropdowns when clicking outside
                document.addEventListener('click', (e) => this.handleOutsideClick(e));

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => this.handleKeyboardShortcuts(e));
            }

            showLoadingScreen() {
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    if (this.currentUser) {
                        this.showMainApp();
                    } else {
                        this.showLoginScreen();
                    }
                }, 2000);
            }

            showLoginScreen() {
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }

            showMainApp() {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                this.updateUserInfo();
                this.renderNavigation();
                this.showSection('dashboard');
            }

            async handleLogin(e) {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const twoFactorCode = document.getElementById('twoFactorCode').value;

                const loginBtn = document.getElementById('loginBtn');
                const spinner = document.getElementById('loginSpinner');
                
                loginBtn.disabled = true;
                spinner.classList.remove('hidden');

                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 1000));

                const user = this.data.users.find(u => u.email === email && u.password === password);
                
                if (!user) {
                    this.showNotification('Invalid email or password', 'error');
                    loginBtn.disabled = false;
                    spinner.classList.add('hidden');
                    return;
                }

                if (user.is2FAEnabled && !twoFactorCode) {
                    document.getElementById('twoFactorSection').classList.remove('hidden');
                    this.showNotification('Please enter your 2FA code', 'info');
                    loginBtn.disabled = false;
                    spinner.classList.add('hidden');
                    return;
                }

                if (user.is2FAEnabled && twoFactorCode !== '123456') {
                    this.showNotification('Invalid 2FA code', 'error');
                    loginBtn.disabled = false;
                    spinner.classList.add('hidden');
                    return;
                }

                this.currentUser = user;
                this.saveToStorage();
                this.showNotification('Login successful!', 'success');
                
                setTimeout(() => {
                    this.showMainApp();
                }, 1000);
            }

            togglePasswordVisibility() {
                const passwordInput = document.getElementById('loginPassword');
                const toggleBtn = document.getElementById('togglePassword');
                const icon = toggleBtn.querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.className = 'fas fa-eye-slash';
                } else {
                    passwordInput.type = 'password';
                    icon.className = 'fas fa-eye';
                }
            }

            selectDemoAccount(e) {
                const email = e.target.dataset.email;
                document.getElementById('loginEmail').value = email;
                document.getElementById('loginPassword').value = 'password123';
                document.getElementById('twoFactorSection').classList.add('hidden');
            }

            logout() {
                this.currentUser = null;
                localStorage.removeItem('attendanceCurrentUser');
                this.showNotification('Logged out successfully', 'success');
                setTimeout(() => {
                    this.showLoginScreen();
                }, 1000);
            }

            updateUserInfo() {
                if (!this.currentUser) return;

                const elements = {
                    userName: this.currentUser.name,
                    userRole: this.currentUser.role.charAt(0).toUpperCase() + this.currentUser.role.slice(1),
                    headerUserName: this.currentUser.name,
                    headerUserRole: this.currentUser.role.charAt(0).toUpperCase() + this.currentUser.role.slice(1),
                    menuUserName: this.currentUser.name,
                    menuUserEmail: this.currentUser.email,
                    userAvatar: this.currentUser.name.charAt(0).toUpperCase()
                };

                Object.entries(elements).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) element.textContent = value;
                });
            }

            renderNavigation() {
                const menuItems = [
                    { id: 'dashboard', icon: 'fas fa-tachometer-alt', roles: ['admin', 'teacher', 'student', 'parent'] },
                    { id: 'attendance', icon: 'fas fa-clipboard-check', roles: ['admin', 'teacher'] },
                    { id: 'myAttendance', icon: 'fas fa-calendar-check', roles: ['student'] },
                    { id: 'childAttendance', icon: 'fas fa-users', roles: ['parent'] },
                    { id: 'classes', icon: 'fas fa-chalkboard-teacher', roles: ['admin', 'teacher'] },
                    { id: 'students', icon: 'fas fa-user-graduate', roles: ['admin', 'teacher'] },
                    { id: 'reports', icon: 'fas fa-chart-bar', roles: ['admin', 'teacher'] },
                    { id: 'leaveRequests', icon: 'fas fa-file-alt', roles: ['admin', 'teacher', 'student'] },
                    { id: 'notifications', icon: 'fas fa-bell', roles: ['admin', 'teacher', 'student', 'parent'] },
                    { id: 'qrScanner', icon: 'fas fa-qrcode', roles: ['student'] },
                    { id: 'faceRecognition', icon: 'fas fa-user-circle', roles: ['student'] },
                    { id: 'biometric', icon: 'fas fa-fingerprint', roles: ['student'] },
                    { id: 'gpsVerification', icon: 'fas fa-map-marker-alt', roles: ['student'] },
                    { id: 'security', icon: 'fas fa-shield-alt', roles: ['admin', 'teacher', 'student', 'parent'] },
                    { id: 'settings', icon: 'fas fa-cog', roles: ['admin', 'teacher'] }
                ];

                const navigationMenu = document.getElementById('navigationMenu');
                navigationMenu.innerHTML = '';

                const filteredItems = menuItems.filter(item => 
                    this.currentUser && item.roles.includes(this.currentUser.role)
                );

                filteredItems.forEach(item => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <a href="#" class="nav-link flex items-center p-3 rounded-lg hover:bg-blue-700 transition-all duration-200" data-section="${item.id}">
                            <i class="${item.icon} mr-3"></i>
                            <span class="nav-text">${this.translate(item.id)}</span>
                        </a>
                    `;
                    
                    li.querySelector('.nav-link').addEventListener('click', (e) => {
                        e.preventDefault();
                        this.showSection(item.id);
                    });
                    
                    navigationMenu.appendChild(li);
                });

                this.updateSidebarState();
            }

            showSection(sectionId) {
                // Remove active class from all nav links
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active', 'bg-blue-700');
                });

                // Add active class to current section
                const activeLink = document.querySelector(`[data-section="${sectionId}"]`);
                if (activeLink) {
                    activeLink.classList.add('active', 'bg-blue-700');
                }

                this.currentSection = sectionId;
                this.renderContent(sectionId);
                
                // Close mobile menu
                this.closeMobileMenu();
            }

            renderContent(sectionId) {
                const mainContent = document.getElementById('mainContent');
                
                switch (sectionId) {
                    case 'dashboard':
                        mainContent.innerHTML = this.renderDashboard();
                        this.initializeDashboard();
                        break;
                    case 'attendance':
                        mainContent.innerHTML = this.renderAttendance();
                        this.initializeAttendance();
                        break;
                    case 'myAttendance':
                        mainContent.innerHTML = this.renderMyAttendance();
                        break;
                    case 'childAttendance':
                        mainContent.innerHTML = this.renderChildAttendance();
                        break;
                    case 'classes':
                        mainContent.innerHTML = this.renderClasses();
                        break;
                    case 'students':
                        mainContent.innerHTML = this.renderStudents();
                        break;
                    case 'reports':
                        mainContent.innerHTML = this.renderReports();
                        this.initializeReports();
                        break;
                    case 'leaveRequests':
                        mainContent.innerHTML = this.renderLeaveRequests();
                        break;
                    case 'notifications':
                        mainContent.innerHTML = this.renderNotifications();
                        break;
                    case 'qrScanner':
                        this.showModal('qrScannerModal');
                        break;
                    case 'faceRecognition':
                        this.showModal('faceRecognitionModal');
                        break;
                    case 'biometric':
                        this.showModal('biometricModal');
                        break;
                    case 'gpsVerification':
                        this.showModal('gpsModal');
                        break;
                    case 'security':
                        mainContent.innerHTML = this.renderSecurity();
                        break;
                    case 'settings':
                        mainContent.innerHTML = this.renderSettings();
                        break;
                    default:
                        mainContent.innerHTML = this.renderDashboard();
                        this.initializeDashboard();
                }
            }

            renderDashboard() {
                const stats = this.getDashboardStats();
                
                return `
                    <div class="space-y-8 fade-in">
                        <!-- Header -->
                        <div class="flex items-center justify-between">
                            <div>
                                <h1 class="text-3xl font-bold text-gray-900 dark:text-white">
                                    ${this.translate('welcome')}, ${this.currentUser.name.split(' ')[0]}!
                                </h1>
                                <p class="text-gray-600 dark:text-gray-400 mt-1">
                                    Here's what's happening in your attendance system today.
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-500 dark:text-gray-400">
                                    ${new Date().toLocaleDateString('en-US', {
                                        weekday: 'long',
                                        year: 'numeric',
                                        month: 'long',
                                        day: 'numeric',
                                    })}
                                </p>
                            </div>
                        </div>

                        <!-- Stats Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div class="card bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white hover:shadow-xl transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-blue-100 text-sm">${this.translate('todaySessions')}</p>
                                        <h3 class="text-3xl font-bold">${stats.todayAttendance}</h3>
                                    </div>
                                    <div class="p-3 rounded-full bg-white bg-opacity-20">
                                        <i class="fas fa-clipboard-check text-2xl"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white hover:shadow-xl transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-green-100 text-sm">${this.translate('totalClasses')}</p>
                                        <h3 class="text-3xl font-bold">${stats.totalClasses}</h3>
                                    </div>
                                    <div class="p-3 rounded-full bg-white bg-opacity-20">
                                        <i class="fas fa-chalkboard-teacher text-2xl"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white hover:shadow-xl transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-purple-100 text-sm">${this.translate('totalStudents')}</p>
                                        <h3 class="text-3xl font-bold">${stats.totalStudents}</h3>
                                    </div>
                                    <div class="p-3 rounded-full bg-white bg-opacity-20">
                                        <i class="fas fa-users text-2xl"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl shadow-lg p-6 text-white hover:shadow-xl transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-orange-100 text-sm">${this.translate('avgAttendance')}</p>
                                        <h3 class="text-3xl font-bold">${stats.averageAttendanceRate}%</h3>
                                    </div>
                                    <div class="p-3 rounded-full bg-white bg-opacity-20">
                                        <i class="fas fa-chart-line text-2xl"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Charts and Tables -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Attendance Chart -->
                            <div class="card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                                        Attendance Overview
                                    </h3>
                                    <button class="text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center space-x-1">
                                        <span>View Details</span>
                                        <i class="fas fa-chevron-right w-4 h-4"></i>
                                    </button>
                                </div>
                                <canvas id="attendanceChart" height="300"></canvas>
                            </div>

                            <!-- Recent Activity -->
                            <div class="card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                                        Recent Activity
                                    </h3>
                                    <button class="text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center space-x-1">
                                        <span>View All</span>
                                        <i class="fas fa-chevron-right w-4 h-4"></i>
                                    </button>
                                </div>
                                <div id="recentActivity">
                                    ${this.renderRecentActivity()}
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        ${this.renderQuickActions()}
                    </div>
                `;
            }

            renderAttendance() {
                return `
                    <div class="space-y-8 fade-in">
                        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-800 dark:text-white">${this.translate('attendance')}</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-1">Mark student attendance for classes</p>
                            </div>
                            <div class="flex space-x-2">
                                <button id="saveAttendanceBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg flex items-center transition shadow-lg">
                                    <i class="fas fa-save mr-2"></i> Save
                                </button>
                                <button id="printAttendanceBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg flex items-center transition shadow-lg">
                                    <i class="fas fa-print mr-2"></i> Print
                                </button>
                            </div>
                        </div>

                        <!-- Attendance Methods -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <button class="attendance-method-btn p-4 bg-white dark:bg-gray-800 rounded-xl shadow-lg border-2 border-transparent hover:border-blue-500 transition-all duration-300" data-method="manual">
                                <i class="fas fa-edit text-3xl text-blue-500 mb-2"></i>
                                <h4 class="font-semibold text-gray-800 dark:text-white">Manual Entry</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Traditional attendance marking</p>
                            </button>
                            
                            <button class="attendance-method-btn p-4 bg-white dark:bg-gray-800 rounded-xl shadow-lg border-2 border-transparent hover:border-green-500 transition-all duration-300" data-method="qr">
                                <i class="fas fa-qrcode text-3xl text-green-500 mb-2"></i>
                                <h4 class="font-semibold text-gray-800 dark:text-white">QR Code</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Quick scan attendance</p>
                            </button>
                            
                            <button class="attendance-method-btn p-4 bg-white dark:bg-gray-800 rounded-xl shadow-lg border-2 border-transparent hover:border-purple-500 transition-all duration-300" data-method="face">
                                <i class="fas fa-user-circle text-3xl text-purple-500 mb-2"></i>
                                <h4 class="font-semibold text-gray-800 dark:text-white">Face Recognition</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">AI-powered identification</p>
                            </button>
                            
                            <button class="attendance-method-btn p-4 bg-white dark:bg-gray-800 rounded-xl shadow-lg border-2 border-transparent hover:border-yellow-500 transition-all duration-300" data-method="biometric">
                                <i class="fas fa-fingerprint text-3xl text-yellow-500 mb-2"></i>
                                <h4 class="font-semibold text-gray-800 dark:text-white">Biometric</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Fingerprint scanning</p>
                            </button>
                        </div>

                        <!-- Attendance Form -->
                        <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Select Class</label>
                                    <select id="classSelect" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                                        <option value="">-- Select Class --</option>
                                        ${this.data.classes.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date</label>
                                    <input type="date" id="attendanceDate" value="${this.formatDate(new Date())}" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Subject</label>
                                    <select id="subjectSelect" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                                        <option value="">-- Select Subject --</option>
                                    </select>
                                </div>
                            </div>

                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Students List</h3>
                                <div class="flex items-center space-x-2">
                                    <button id="markAllPresentBtn" class="text-xs bg-green-100 hover:bg-green-200 text-green-800 px-3 py-2 rounded-lg transition">
                                        <i class="fas fa-check mr-1"></i> Mark All Present
                                    </button>
                                    <button id="markAllAbsentBtn" class="text-xs bg-red-100 hover:bg-red-200 text-red-800 px-3 py-2 rounded-lg transition">
                                        <i class="fas fa-times mr-1"></i> Mark All Absent
                                    </button>
                                </div>
                            </div>

                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Roll No</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Name</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="attendanceTableBody">
                                        <tr>
                                            <td colspan="4" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                                                <i class="fas fa-users text-4xl text-gray-300 mb-3"></i>
                                                <p>Please select a class to view students</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderMyAttendance() {
                const studentAttendance = this.getStudentAttendance(this.currentUser.id);
                
                return `
                    <div class="space-y-8 fade-in">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-800 dark:text-white">${this.translate('myAttendance')}</h2>
                            <p class="text-gray-600 dark:text-gray-400 mt-1">View your attendance records and statistics</p>
                        </div>

                        <!-- Attendance Stats -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="card bg-gradient-to-r from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-green-100 text-sm">Present Days</p>
                                        <h3 class="text-3xl font-bold">${studentAttendance.presentCount}</h3>
                                    </div>
                                    <i class="fas fa-check-circle text-3xl text-green-200"></i>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-red-500 to-red-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-red-100 text-sm">Absent Days</p>
                                        <h3 class="text-3xl font-bold">${studentAttendance.absentCount}</h3>
                                    </div>
                                    <i class="fas fa-times-circle text-3xl text-red-200"></i>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-blue-100 text-sm">Attendance Rate</p>
                                        <h3 class="text-3xl font-bold">${studentAttendance.attendanceRate}%</h3>
                                    </div>
                                    <i class="fas fa-percentage text-3xl text-blue-200"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Attendance Calendar -->
                        <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Attendance Calendar</h3>
                            <div class="grid grid-cols-7 gap-2 text-center">
                                <div class="font-semibold text-gray-600 dark:text-gray-400 p-2">Sun</div>
                                <div class="font-semibold text-gray-600 dark:text-gray-400 p-2">Mon</div>
                                <div class="font-semibold text-gray-600 dark:text-gray-400 p-2">Tue</div>
                                <div class="font-semibold text-gray-600 dark:text-gray-400 p-2">Wed</div>
                                <div class="font-semibold text-gray-600 dark:text-gray-400 p-2">Thu</div>
                                <div class="font-semibold text-gray-600 dark:text-gray-400 p-2">Fri</div>
                                <div class="font-semibold text-gray-600 dark:text-gray-400 p-2">Sat</div>
                                ${this.generateCalendarDays()}
                            </div>
                        </div>

                        <!-- Recent Records -->
                        <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Recent Records</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Subject</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Time</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        ${this.renderStudentAttendanceRecords()}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderChildAttendance() {
                return `
                    <div class="space-y-8 fade-in">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-800 dark:text-white">${this.translate('childAttendance')}</h2>
                            <p class="text-gray-600 dark:text-gray-400 mt-1">Monitor your child's attendance and academic progress</p>
                        </div>

                        <!-- Child Selection -->
                        <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Select Child</label>
                            <select id="childSelect" class="w-full md:w-1/3 border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                                ${this.getParentChildren().map(child => 
                                    `<option value="${child.id}">${child.name} (${child.rollNo})</option>`
                                ).join('')}
                            </select>
                        </div>

                        <!-- Child Stats -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                            <div class="card bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="text-center">
                                    <i class="fas fa-calendar-check text-3xl mb-2"></i>
                                    <p class="text-blue-100 text-sm">Total Sessions</p>
                                    <h3 class="text-2xl font-bold">45</h3>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="text-center">
                                    <i class="fas fa-check-circle text-3xl mb-2"></i>
                                    <p class="text-green-100 text-sm">Present</p>
                                    <h3 class="text-2xl font-bold">42</h3>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-red-500 to-red-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="text-center">
                                    <i class="fas fa-times-circle text-3xl mb-2"></i>
                                    <p class="text-red-100 text-sm">Absent</p>
                                    <h3 class="text-2xl font-bold">3</h3>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="text-center">
                                    <i class="fas fa-percentage text-3xl mb-2"></i>
                                    <p class="text-purple-100 text-sm">Attendance Rate</p>
                                    <h3 class="text-2xl font-bold">93%</h3>
                                </div>
                            </div>
                        </div>

                        <!-- Attendance Alerts -->
                        <div class="card bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-6">
                            <div class="flex items-start space-x-4">
                                <div class="p-2 bg-yellow-100 dark:bg-yellow-900/40 rounded-lg">
                                    <i class="fas fa-exclamation-triangle text-yellow-600 dark:text-yellow-400"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-yellow-900 dark:text-yellow-100">Attendance Alert</h3>
                                    <p class="text-yellow-800 dark:text-yellow-200 mt-1">
                                        Your child was absent on Mathematics class yesterday. Please ensure regular attendance for better academic performance.
                                    </p>
                                    <button class="mt-3 text-yellow-600 dark:text-yellow-400 hover:text-yellow-800 dark:hover:text-yellow-200 text-sm font-medium">
                                        View Details ‚Üí
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Recent Activity</h3>
                            <div class="space-y-4">
                                <div class="flex items-center space-x-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                    <div class="w-10 h-10 bg-green-100 dark:bg-green-900/40 rounded-full flex items-center justify-center">
                                        <i class="fas fa-check text-green-600 dark:text-green-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">Present in Physics</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">Today, 10:00 AM</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center space-x-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                    <div class="w-10 h-10 bg-green-100 dark:bg-green-900/40 rounded-full flex items-center justify-center">
                                        <i class="fas fa-check text-green-600 dark:text-green-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">Present in Mathematics</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">Today, 9:00 AM</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center space-x-4 p-4 bg-red-50 dark:bg-red-900/20 rounded-lg">
                                    <div class="w-10 h-10 bg-red-100 dark:bg-red-900/40 rounded-full flex items-center justify-center">
                                        <i class="fas fa-times text-red-600 dark:text-red-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">Absent from Chemistry</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">Yesterday, 11:00 AM</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderClasses() {
                return `
                    <div class="space-y-8 fade-in">
                        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-800 dark:text-white">${this.translate('classes')}</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-1">Create and manage class information</p>
                            </div>
                            <button id="addClassBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center transition shadow-lg">
                                <i class="fas fa-plus mr-2"></i> Add Class
                            </button>
                        </div>

                        <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Class ID</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Class Name</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Students</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Subjects</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        ${this.data.classes.map(classObj => {
                                            const studentCount = this.data.students.filter(s => s.classId === classObj.id).length;
                                            return `
                                                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${classObj.id}</td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${classObj.name}</td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                                                            ${studentCount} students
                                                        </span>
                                                    </td>
                                                    <td class="px-6 py-4 text-sm text-gray-900 dark:text-white max-w-xs">
                                                        <div class="flex flex-wrap gap-1">
                                                            ${classObj.subjects.map(subject => 
                                                                `<span class="px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded">${subject}</span>`
                                                            ).join('')}
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                        <button class="text-blue-600 hover:text-blue-900 mr-3 p-1" title="Edit">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="text-red-600 hover:text-red-900 p-1" title="Delete">
                                                            <i class="fas fa-trash-alt"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderStudents() {
                return `
                    <div class="space-y-8 fade-in">
                        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-800 dark:text-white">${this.translate('students')}</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-1">Add and manage student information</p>
                            </div>
                            <div class="flex space-x-2">
                                <button id="addStudentBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center transition shadow-lg">
                                    <i class="fas fa-plus mr-2"></i> Add Student
                                </button>
                                <button id="importStudentsBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg flex items-center transition shadow-lg">
                                    <i class="fas fa-file-import mr-2"></i> Import
                                </button>
                            </div>
                        </div>

                        <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Filter by Class</label>
                                <select id="filterClassSelect" class="w-full md:w-1/3 border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                                    <option value="">All Classes</option>
                                    ${this.data.classes.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                                </select>
                            </div>

                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Roll No</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Name</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Class</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Contact</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        ${this.data.students.map(student => {
                                            const classObj = this.data.classes.find(c => c.id === student.classId);
                                            return `
                                                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${student.rollNo}</td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${student.name}</td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                                                            ${classObj ? classObj.name : 'Unknown Class'}
                                                        </span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                        <div>
                                                            <div class="text-sm text-gray-900 dark:text-white">${student.email || 'N/A'}</div>
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                        <button class="text-blue-600 hover:text-blue-900 mr-3 p-1" title="Edit">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="text-red-600 hover:text-red-900 p-1" title="Delete">
                                                            <i class="fas fa-trash-alt"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderReports() {
                return `
                    <div class="space-y-8 fade-in">
                        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-800 dark:text-white">${this.translate('reports')}</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-1">Generate and export attendance reports</p>
                            </div>
                            <div class="flex space-x-2">
                                <button id="exportPDFBtn" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg flex items-center transition shadow-lg">
                                    <i class="fas fa-file-pdf mr-2"></i> Export PDF
                                </button>
                                <button id="exportExcelBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg flex items-center transition shadow-lg">
                                    <i class="fas fa-file-excel mr-2"></i> Export Excel
                                </button>
                                <button id="exportRegisterBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg flex items-center transition shadow-lg">
                                    <i class="fas fa-book mr-2"></i> Register PDF
                                </button>
                            </div>
                        </div>

                        <!-- Report Filters -->
                        <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Select Class</label>
                                    <select id="reportClassSelect" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                                        <option value="">All Classes</option>
                                        ${this.data.classes.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">From Date</label>
                                    <input type="date" id="fromDate" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">To Date</label>
                                    <input type="date" id="toDate" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                                </div>
                                <div class="flex items-end">
                                    <button id="filterReportBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition">
                                        <i class="fas fa-filter mr-2"></i> Apply Filters
                                    </button>
                                </div>
                            </div>

                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Class</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Subject</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Present</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Absent</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Percentage</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="reportsTableBody">
                                        ${this.renderReportTableRows()}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderLeaveRequests() {
                return `
                    <div class="space-y-8 fade-in">
                        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-800 dark:text-white">${this.translate('leaveRequests')}</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-1">Manage leave requests and approvals</p>
                            </div>
                            ${this.currentUser.role === 'student' ? `
                                <button id="newLeaveRequestBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center transition shadow-lg">
                                    <i class="fas fa-plus mr-2"></i> New Request
                                </button>
                            ` : ''}
                        </div>

                        <!-- Leave Request Stats -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                            <div class="card bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="text-center">
                                    <i class="fas fa-clock text-3xl mb-2"></i>
                                    <p class="text-yellow-100 text-sm">Pending</p>
                                    <h3 class="text-2xl font-bold">3</h3>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="text-center">
                                    <i class="fas fa-check-circle text-3xl mb-2"></i>
                                    <p class="text-green-100 text-sm">Approved</p>
                                    <h3 class="text-2xl font-bold">12</h3>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-red-500 to-red-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="text-center">
                                    <i class="fas fa-times-circle text-3xl mb-2"></i>
                                    <p class="text-red-100 text-sm">Rejected</p>
                                    <h3 class="text-2xl font-bold">2</h3>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="text-center">
                                    <i class="fas fa-calendar-alt text-3xl mb-2"></i>
                                    <p class="text-blue-100 text-sm">This Month</p>
                                    <h3 class="text-2xl font-bold">5</h3>
                                </div>
                            </div>
                        </div>

                        <!-- Leave Requests Table -->
                        <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Student</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Type</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Duration</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Reason</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">Alice Johnson</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">Medical</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">2024-01-15 to 2024-01-17</td>
                                            <td class="px-6 py-4 text-sm text-gray-900 dark:text-white max-w-xs truncate">Doctor appointment and recovery</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">
                                                    Pending
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                <button class="text-green-600 hover:text-green-900 mr-3 p-1" title="Approve">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button class="text-red-600 hover:text-red-900 p-1" title="Reject">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">Bob Smith</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">Personal</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">2024-01-20</td>
                                            <td class="px-6 py-4 text-sm text-gray-900 dark:text-white max-w-xs truncate">Family function</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                                                    Approved
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                <button class="text-blue-600 hover:text-blue-900 p-1" title="View">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderNotifications() {
                return `
                    <div class="space-y-8 fade-in">
                        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-800 dark:text-white">${this.translate('notifications')}</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-1">Stay updated with important alerts and messages</p>
                            </div>
                            <div class="flex space-x-2">
                                <button id="markAllReadBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center transition shadow-lg">
                                    <i class="fas fa-check-double mr-2"></i> Mark All Read
                                </button>
                                <button id="notificationSettingsBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg flex items-center transition shadow-lg">
                                    <i class="fas fa-cog mr-2"></i> Settings
                                </button>
                            </div>
                        </div>

                        <!-- Notification Categories -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                            <div class="card bg-gradient-to-r from-red-500 to-red-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="text-center">
                                    <i class="fas fa-exclamation-triangle text-3xl mb-2"></i>
                                    <p class="text-red-100 text-sm">Urgent Alerts</p>
                                    <h3 class="text-2xl font-bold">2</h3>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="text-center">
                                    <i class="fas fa-user-times text-3xl mb-2"></i>
                                    <p class="text-yellow-100 text-sm">Absence Alerts</p>
                                    <h3 class="text-2xl font-bold">5</h3>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="text-center">
                                    <i class="fas fa-bullhorn text-3xl mb-2"></i>
                                    <p class="text-blue-100 text-sm">Announcements</p>
                                    <h3 class="text-2xl font-bold">3</h3>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="text-center">
                                    <i class="fas fa-bell text-3xl mb-2"></i>
                                    <p class="text-green-100 text-sm">Reminders</p>
                                    <h3 class="text-2xl font-bold">8</h3>
                                </div>
                            </div>
                        </div>

                        <!-- Notifications List -->
                        <div class="space-y-4">
                            <!-- Urgent Notification -->
                            <div class="card bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500 p-6 rounded-xl">
                                <div class="flex items-start space-x-4">
                                    <div class="p-2 bg-red-100 dark:bg-red-900/40 rounded-lg">
                                        <i class="fas fa-exclamation-triangle text-red-600 dark:text-red-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <h3 class="text-lg font-semibold text-red-900 dark:text-red-100">Low Attendance Alert</h3>
                                            <span class="text-xs text-red-600 dark:text-red-400">2 hours ago</span>
                                        </div>
                                        <p class="text-red-800 dark:text-red-200 mt-1">
                                            Student Alice Johnson's attendance has dropped below 75%. Immediate attention required.
                                        </p>
                                        <div class="mt-3 flex space-x-2">
                                            <button class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-200 text-sm font-medium">
                                                View Details
                                            </button>
                                            <button class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-200 text-sm font-medium">
                                                Contact Parent
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Regular Notification -->
                            <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 p-6 rounded-xl">
                                <div class="flex items-start space-x-4">
                                    <div class="p-2 bg-blue-100 dark:bg-blue-900/40 rounded-lg">
                                        <i class="fas fa-bullhorn text-blue-600 dark:text-blue-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">School Holiday Announcement</h3>
                                            <span class="text-xs text-gray-500 dark:text-gray-400">1 day ago</span>
                                        </div>
                                        <p class="text-gray-700 dark:text-gray-300 mt-1">
                                            School will be closed on January 26th for Republic Day. Classes will resume on January 27th.
                                        </p>
                                        <button class="mt-3 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200 text-sm font-medium">
                                            Mark as Read
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Success Notification -->
                            <div class="card bg-green-50 dark:bg-green-900/20 border-l-4 border-green-500 p-6 rounded-xl">
                                <div class="flex items-start space-x-4">
                                    <div class="p-2 bg-green-100 dark:bg-green-900/40 rounded-lg">
                                        <i class="fas fa-check-circle text-green-600 dark:text-green-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <h3 class="text-lg font-semibold text-green-900 dark:text-green-100">Attendance Report Generated</h3>
                                            <span class="text-xs text-green-600 dark:text-green-400">3 days ago</span>
                                        </div>
                                        <p class="text-green-800 dark:text-green-200 mt-1">
                                            Monthly attendance report for Grade 10-A has been successfully generated and sent to your email.
                                        </p>
                                        <button class="mt-3 text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-200 text-sm font-medium">
                                            Download Report
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Warning Notification -->
                            <div class="card bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 p-6 rounded-xl">
                                <div class="flex items-start space-x-4">
                                    <div class="p-2 bg-yellow-100 dark:bg-yellow-900/40 rounded-lg">
                                        <i class="fas fa-exclamation-circle text-yellow-600 dark:text-yellow-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <h3 class="text-lg font-semibold text-yellow-900 dark:text-yellow-100">System Maintenance Scheduled</h3>
                                            <span class="text-xs text-yellow-600 dark:text-yellow-400">1 week ago</span>
                                        </div>
                                        <p class="text-yellow-800 dark:text-yellow-200 mt-1">
                                            System maintenance is scheduled for this weekend. The system will be unavailable from 2 AM to 6 AM.
                                        </p>
                                        <button class="mt-3 text-yellow-600 dark:text-yellow-400 hover:text-yellow-800 dark:hover:text-yellow-200 text-sm font-medium">
                                            View Schedule
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderSecurity() {
                return `
                    <div class="space-y-8 fade-in">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-800 dark:text-white">${this.translate('security')}</h2>
                            <p class="text-gray-600 dark:text-gray-400 mt-1">Manage your account security and privacy settings</p>
                        </div>

                        <!-- Security Overview -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="card bg-gradient-to-r from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-green-100 text-sm">Security Score</p>
                                        <h3 class="text-3xl font-bold">85%</h3>
                                    </div>
                                    <i class="fas fa-shield-alt text-3xl text-green-200"></i>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-blue-100 text-sm">2FA Status</p>
                                        <h3 class="text-lg font-bold">${this.currentUser.is2FAEnabled ? 'Enabled' : 'Disabled'}</h3>
                                    </div>
                                    <i class="fas fa-mobile-alt text-3xl text-blue-200"></i>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-purple-100 text-sm">Last Login</p>
                                        <h3 class="text-lg font-bold">Today</h3>
                                    </div>
                                    <i class="fas fa-clock text-3xl text-purple-200"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Security Settings -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Authentication Settings -->
                            <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Authentication</h3>
                                <div class="space-y-6">
                                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                        <div>
                                            <h4 class="font-medium text-gray-900 dark:text-white">Two-Factor Authentication</h4>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Add an extra layer of security to your account</p>
                                        </div>
                                        <button id="toggle2FABtn" class="px-4 py-2 ${this.currentUser.is2FAEnabled ? 'bg-red-600 hover:bg-red-700' : 'bg-green-600 hover:bg-green-700'} text-white rounded-lg transition">
                                            ${this.currentUser.is2FAEnabled ? 'Disable' : 'Enable'}
                                        </button>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                        <div>
                                            <h4 class="font-medium text-gray-900 dark:text-white">Change Password</h4>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Update your account password</p>
                                        </div>
                                        <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition">
                                            Change
                                        </button>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                        <div>
                                            <h4 class="font-medium text-gray-900 dark:text-white">Login Notifications</h4>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Get notified of new login attempts</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Privacy Settings -->
                            <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Privacy</h3>
                                <div class="space-y-6">
                                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                        <div>
                                            <h4 class="font-medium text-gray-900 dark:text-white">Profile Visibility</h4>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Control who can see your profile information</p>
                                        </div>
                                        <select class="border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                            <option>Everyone</option>
                                            <option>School Only</option>
                                            <option>Teachers Only</option>
                                        </select>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                        <div>
                                            <h4 class="font-medium text-gray-900 dark:text-white">Data Export</h4>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Download your personal data</p>
                                        </div>
                                        <button class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition">
                                            Export
                                        </button>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                        <div>
                                            <h4 class="font-medium text-gray-900 dark:text-white">Account Deletion</h4>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Permanently delete your account</p>
                                        </div>
                                        <button class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition">
                                            Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Security Activity -->
                        <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Recent Security Activity</h3>
                            <div class="space-y-4">
                                <div class="flex items-center space-x-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                    <div class="w-10 h-10 bg-green-100 dark:bg-green-900/40 rounded-full flex items-center justify-center">
                                        <i class="fas fa-sign-in-alt text-green-600 dark:text-green-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">Successful login</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">Today at 9:30 AM from Chrome on Windows</p>
                                    </div>
                                    <span class="text-xs text-green-600 dark:text-green-400 font-medium">Verified</span>
                                </div>
                                
                                <div class="flex items-center space-x-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                    <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/40 rounded-full flex items-center justify-center">
                                        <i class="fas fa-key text-blue-600 dark:text-blue-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">Password changed</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">3 days ago</p>
                                    </div>
                                    <span class="text-xs text-blue-600 dark:text-blue-400 font-medium">Secure</span>
                                </div>
                                
                                <div class="flex items-center space-x-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                                    <div class="w-10 h-10 bg-yellow-100 dark:bg-yellow-900/40 rounded-full flex items-center justify-center">
                                        <i class="fas fa-exclamation-triangle text-yellow-600 dark:text-yellow-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">Failed login attempt</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">1 week ago from unknown device</p>
                                    </div>
                                    <span class="text-xs text-yellow-600 dark:text-yellow-400 font-medium">Blocked</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderSettings() {
                return `
                    <div class="space-y-8 fade-in">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-800 dark:text-white">${this.translate('settings')}</h2>
                            <p class="text-gray-600 dark:text-gray-400 mt-1">Configure system preferences and manage data</p>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- General Settings -->
                            <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">General Settings</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Institution Name</label>
                                        <input type="text" id="institutionName" value="${this.data.settings.institutionName}" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Time Zone</label>
                                        <select id="timeZoneSelect" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                                            <option value="UTC" ${this.data.settings.timeZone === 'UTC' ? 'selected' : ''}>UTC</option>
                                            <option value="EST" ${this.data.settings.timeZone === 'EST' ? 'selected' : ''}>Eastern Standard Time</option>
                                            <option value="PST" ${this.data.settings.timeZone === 'PST' ? 'selected' : ''}>Pacific Standard Time</option>
                                            <option value="IST" ${this.data.settings.timeZone === 'IST' ? 'selected' : ''}>Indian Standard Time</option>
                                        </select>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="font-medium text-gray-900 dark:text-white">Email Notifications</h4>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Receive email alerts for important events</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="notificationsEnabled" class="sr-only peer" ${this.data.settings.notificationsEnabled ? 'checked' : ''}>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                        </label>
                                    </div>
                                    
                                    <button id="saveSettingsBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition">
                                        <i class="fas fa-save mr-2"></i> Save Settings
                                    </button>
                                </div>
                            </div>

                            <!-- Attendance Settings -->
                            <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Attendance Settings</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Auto-mark Threshold (minutes)</label>
                                        <input type="number" id="autoMarkThreshold" value="${this.data.settings.autoMarkThreshold}" min="5" max="60" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Minutes late before marked absent</p>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Minimum Attendance (%)</label>
                                        <input type="number" id="minimumAttendance" value="${this.data.settings.minimumAttendancePercentage}" min="50" max="100" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Required attendance percentage</p>
                                    </div>
                                    
                                    <div class="space-y-4">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <h4 class="font-medium text-gray-900 dark:text-white">Allow Late Entry</h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Students can mark attendance after class starts</p>
                                            </div>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="allowLateEntry" class="sr-only peer" ${this.data.settings.allowLateEntry ? 'checked' : ''}>
                                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                            </label>
                                        </div>
                                        
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <h4 class="font-medium text-gray-900 dark:text-white">GPS Verification</h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Require location verification for attendance</p>
                                            </div>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="requireGPS" class="sr-only peer" ${this.data.settings.requireGPSVerification ? 'checked' : ''}>
                                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                            </label>
                                        </div>
                                        
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <h4 class="font-medium text-gray-900 dark:text-white">Face Recognition</h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Enable AI-powered face recognition</p>
                                            </div>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="enableFaceRecognition" class="sr-only peer" ${this.data.settings.enableFaceRecognition ? 'checked' : ''}>
                                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                            </label>
                                        </div>
                                        
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <h4 class="font-medium text-gray-900 dark:text-white">QR Code Attendance</h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Allow QR code scanning for attendance</p>
                                            </div>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="enableQRCode" class="sr-only peer" ${this.data.settings.enableQRCode ? 'checked' : ''}>
                                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Data Management -->
                        <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Data Management</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900/40 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i class="fas fa-download text-2xl text-blue-600 dark:text-blue-400"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-900 dark:text-white mb-2">Backup Data</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Download a complete backup of your data</p>
                                    <button id="backupDataBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition">
                                        <i class="fas fa-download mr-2"></i> Backup
                                    </button>
                                </div>
                                
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-green-100 dark:bg-green-900/40 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i class="fas fa-upload text-2xl text-green-600 dark:text-green-400"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-900 dark:text-white mb-2">Restore Data</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Restore data from a backup file</p>
                                    <button id="restoreDataBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition">
                                        <i class="fas fa-upload mr-2"></i> Restore
                                    </button>
                                    <input type="file" id="restoreFileInput" class="hidden" accept=".json">
                                </div>
                                
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-red-100 dark:bg-red-900/40 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i class="fas fa-trash-alt text-2xl text-red-600 dark:text-red-400"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-900 dark:text-white mb-2">Reset Data</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Permanently delete all data</p>
                                    <button id="resetDataBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition">
                                        <i class="fas fa-trash-alt mr-2"></i> Reset
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderQuickActions() {
                const actions = [
                    { id: 'quickAttendance', title: 'Take Attendance', description: 'Mark today\'s attendance', icon: 'fas fa-plus-circle', color: 'blue', roles: ['admin', 'teacher'] },
                    { id: 'quickAddStudent', title: 'Add Student', description: 'Register new student', icon: 'fas fa-user-plus', color: 'green', roles: ['admin', 'teacher'] },
                    { id: 'quickReport', title: 'Generate Report', description: 'View attendance reports', icon: 'fas fa-chart-bar', color: 'purple', roles: ['admin', 'teacher'] },
                    { id: 'quickQRScan', title: 'QR Scanner', description: 'Scan attendance QR code', icon: 'fas fa-qrcode', color: 'orange', roles: ['student'] }
                ];

                const filteredActions = actions.filter(action => 
                    this.currentUser && action.roles.includes(this.currentUser.role)
                );

                if (filteredActions.length === 0) return '';

                return `
                    <div class="card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Quick Actions</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-${Math.min(filteredActions.length, 4)} gap-4">
                            ${filteredActions.map(action => `
                                <button class="quick-action-btn p-6 bg-${action.color}-50 dark:bg-${action.color}-900/20 hover:bg-${action.color}-100 dark:hover:bg-${action.color}-900/30 border border-${action.color}-200 dark:border-${action.color}-800 rounded-xl transition-all duration-300 text-left group" data-action="${action.id}">
                                    <i class="${action.icon} text-${action.color}-600 dark:text-${action.color}-400 text-3xl mb-4 group-hover:scale-110 transition-transform"></i>
                                    <h4 class="font-semibold text-gray-900 dark:text-white mb-2">${action.title}</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">${action.description}</p>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            renderRecentActivity() {
                const recentRecords = this.data.attendance
                    .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
                    .slice(0, 5);

                if (recentRecords.length === 0) {
                    return `
                        <div class="text-center py-8">
                            <i class="fas fa-clock text-4xl text-gray-300 dark:text-gray-600 mb-3"></i>
                            <p class="text-gray-500 dark:text-gray-400">No recent activity</p>
                        </div>
                    `;
                }

                return recentRecords.map(record => {
                    const classObj = this.data.classes.find(c => c.id === record.classId);
                    const presentCount = record.records.filter(r => r.status === 'present' || r.status === 'late').length;
                    const totalCount = record.records.length;
                    const attendanceRate = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
                    
                    return `
                        <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="p-2 bg-blue-100 dark:bg-blue-900/40 rounded-lg">
                                    <i class="fas fa-book-open w-4 h-4 text-blue-600 dark:text-blue-400"></i>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">
                                        ${record.subject} - ${classObj?.name || 'Unknown Class'}
                                    </p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        ${this.formatDate(new Date(record.date), true)} ‚Ä¢ Period ${record.period}
                                    </p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-users w-4 h-4 text-gray-400"></i>
                                    <span class="text-sm text-gray-600 dark:text-gray-400">
                                        ${presentCount}/${totalCount}
                                    </span>
                                </div>
                                <div class="text-xs font-medium mt-1 ${
                                    attendanceRate >= 80 
                                        ? 'text-green-600 dark:text-green-400'
                                        : attendanceRate >= 60
                                        ? 'text-yellow-600 dark:text-yellow-400'
                                        : 'text-red-600 dark:text-red-400'
                                }">
                                    ${attendanceRate}% present
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderReportTableRows() {
                const recentRecords = this.data.attendance
                    .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
                    .slice(0, 10);

                if (recentRecords.length === 0) {
                    return `
                        <tr>
                            <td colspan="6" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                                <i class="fas fa-file-alt text-4xl text-gray-300 mb-3"></i>
                                <p>No attendance records found</p>
                            </td>
                        </tr>
                    `;
                }

                return recentRecords.map(record => {
                    const classObj = this.data.classes.find(c => c.id === record.classId);
                    const presentCount = record.records.filter(r => r.status === 'present' || r.status === 'late').length;
                    const absentCount = record.records.length - presentCount;
                    const percentage = record.records.length > 0 ? 
                        Math.round((presentCount / record.records.length) * 100) : 0;
                    
                    return `
                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${record.date}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${classObj ? classObj.name : 'Unknown'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${record.subject}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600 dark:text-green-400 font-medium">${presentCount}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600 dark:text-red-400 font-medium">${absentCount}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full ${
                                    percentage >= 80 ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' :
                                    percentage >= 60 ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200' :
                                    'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'
                                }">
                                    ${percentage}%
                                </span>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            renderStudentAttendanceRecords() {
                // Mock student attendance records for demo
                const records = [
                    { date: '2024-01-15', subject: 'Mathematics', status: 'present', time: '09:00 AM' },
                    { date: '2024-01-15', subject: 'Physics', status: 'present', time: '10:00 AM' },
                    { date: '2024-01-14', subject: 'Chemistry', status: 'late', time: '11:15 AM' },
                    { date: '2024-01-14', subject: 'English', status: 'present', time: '02:00 PM' },
                    { date: '2024-01-13', subject: 'Biology', status: 'absent', time: '-' }
                ];

                return records.map(record => `
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${record.date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${record.subject}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full status-${record.status}">
                                ${this.translate(record.status)}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${record.time}</td>
                    </tr>
                `).join('');
            }

            generateCalendarDays() {
                const today = new Date();
                const currentMonth = today.getMonth();
                const currentYear = today.getFullYear();
                const firstDay = new Date(currentYear, currentMonth, 1);
                const lastDay = new Date(currentYear, currentMonth + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());

                let calendarHTML = '';
                const currentDate = new Date(startDate);

                for (let week = 0; week < 6; week++) {
                    for (let day = 0; day < 7; day++) {
                        const isCurrentMonth = currentDate.getMonth() === currentMonth;
                        const isToday = currentDate.toDateString() === today.toDateString();
                        const dayNumber = currentDate.getDate();
                        
                        // Mock attendance status for demo
                        let attendanceStatus = '';
                        if (isCurrentMonth && currentDate <= today) {
                            const random = Math.random();
                            if (random > 0.8) attendanceStatus = 'bg-red-100 text-red-800';
                            else if (random > 0.9) attendanceStatus = 'bg-yellow-100 text-yellow-800';
                            else attendanceStatus = 'bg-green-100 text-green-800';
                        }

                        calendarHTML += `
                            <div class="p-2 text-center ${isCurrentMonth ? 'text-gray-900 dark:text-white' : 'text-gray-400 dark:text-gray-600'} ${isToday ? 'bg-blue-500 text-white rounded-lg' : ''} ${attendanceStatus} transition-colors">
                                ${dayNumber}
                            </div>
                        `;
                        
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                }

                return calendarHTML;
            }

            // Utility Methods
            getDashboardStats() {
                const today = this.formatDate(new Date());
                const todayAttendance = this.data.attendance.filter(a => a.date === today);
                
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                let totalPresent = 0;
                let totalPossible = 0;
                
                this.data.attendance.forEach(record => {
                    const presentCount = record.records.filter(r => r.status === 'present' || r.status === 'late').length;
                    totalPresent += presentCount;
                    totalPossible += record.records.length;
                });
                
                const averageAttendanceRate = totalPossible > 0 ? Math.round((totalPresent / totalPossible) * 100) : 0;

                return {
                    todayAttendance: todayAttendance.length,
                    totalClasses: this.data.classes.length,
                    totalStudents: this.data.students.length,
                    averageAttendanceRate
                };
            }

            getStudentAttendance(studentId) {
                const studentRecords = this.data.attendance
                    .map(record => record.records.find(r => r.studentId === studentId))
                    .filter(Boolean);

                const totalSessions = studentRecords.length;
                const presentCount = studentRecords.filter(r => r.status === 'present' || r.status === 'late').length;
                const absentCount = studentRecords.filter(r => r.status === 'absent').length;
                const attendanceRate = totalSessions > 0 ? Math.round((presentCount / totalSessions) * 100) : 0;

                return {
                    totalSessions,
                    presentCount,
                    absentCount,
                    attendanceRate
                };
            }

            getParentChildren() {
                if (!this.currentUser || this.currentUser.role !== 'parent') return [];
                return this.data.students.filter(student => 
                    this.currentUser.studentIds && this.currentUser.studentIds.includes(student.id)
                );
            }

            initializeDashboard() {
                this.initializeAttendanceChart();
                this.setupQuickActions();
            }

            initializeAttendance() {
                this.setupAttendanceEventListeners();
            }

            initializeReports() {
                this.setDefaultDateRange();
                this.setupReportEventListeners();
            }

            initializeAttendanceChart() {
                const ctx = document.getElementById('attendanceChart');
                if (!ctx) return;

                // Get last 7 days data
                const days = [];
                const today = new Date();
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    days.push(this.formatDate(date));
                }

                const attendanceRates = days.map(date => {
                    const dayRecords = this.data.attendance.filter(record => record.date === date);
                    
                    if (dayRecords.length === 0) return 0;
                    
                    let totalPresent = 0;
                    let totalStudents = 0;
                    
                    dayRecords.forEach(record => {
                        const presentCount = record.records.filter(r => 
                            r.status === 'present' || r.status === 'late'
                        ).length;
                        totalPresent += presentCount;
                        totalStudents += record.records.length;
                    });
                    
                    return totalStudents > 0 ? Math.round((totalPresent / totalStudents) * 100) : 0;
                });

                const labels = days.map(date => {
                    const d = new Date(date);
                    return d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                });

                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [{
                            label: 'Attendance Rate (%)',
                            data: attendanceRates,
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: 'rgb(59, 130, 246)',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false,
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: 'rgb(243, 244, 246)',
                                bodyColor: 'rgb(209, 213, 219)',
                                borderColor: 'rgba(75, 85, 99, 0.2)',
                                borderWidth: 1,
                                cornerRadius: 8,
                                displayColors: false,
                                callbacks: {
                                    label: function(context) {
                                        return `${Math.round(context.parsed.y)}% attendance`;
                                    },
                                },
                            },
                        },
                        scales: {
                            x: {
                                border: {
                                    display: false,
                                },
                                grid: {
                                    display: false,
                                },
                                ticks: {
                                    color: 'rgb(107, 114, 128)',
                                    font: {
                                        size: 12,
                                    },
                                },
                            },
                            y: {
                                border: {
                                    display: false,
                                },
                                grid: {
                                    color: 'rgba(75, 85, 99, 0.1)',
                                },
                                ticks: {
                                    color: 'rgb(107, 114, 128)',
                                    font: {
                                        size: 12,
                                    },
                                    callback: function(value) {
                                        return value + '%';
                                    },
                                },
                                min: 0,
                                max: 100,
                            },
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index',
                        },
                    }
                });
            }

            setupQuickActions() {
                document.querySelectorAll('.quick-action-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const action = e.currentTarget.dataset.action;
                        this.handleQuickAction(action);
                    });
                });
            }

            handleQuickAction(action) {
                switch (action) {
                    case 'quickAttendance':
                        this.showSection('attendance');
                        break;
                    case 'quickAddStudent':
                        this.showSection('students');
                        break;
                    case 'quickReport':
                        this.showSection('reports');
                        break;
                    case 'quickQRScan':
                        this.showModal('qrScannerModal');
                        break;
                }
            }

            setupAttendanceEventListeners() {
                const classSelect = document.getElementById('classSelect');
                const subjectSelect = document.getElementById('subjectSelect');
                
                if (classSelect) {
                    classSelect.addEventListener('change', (e) => {
                        this.populateSubjects(parseInt(e.target.value));
                        this.populateAttendanceTable(parseInt(e.target.value));
                    });
                }

                // Attendance method buttons
                document.querySelectorAll('.attendance-method-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const method = e.currentTarget.dataset.method;
                        this.selectAttendanceMethod(method);
                    });
                });

                // Mark all buttons
                const markAllPresentBtn = document.getElementById('markAllPresentBtn');
                const markAllAbsentBtn = document.getElementById('markAllAbsentBtn');
                
                if (markAllPresentBtn) {
                    markAllPresentBtn.addEventListener('click', () => this.markAllAttendance(true));
                }
                
                if (markAllAbsentBtn) {
                    markAllAbsentBtn.addEventListener('click', () => this.markAllAttendance(false));
                }

                // Save and print buttons
                const saveBtn = document.getElementById('saveAttendanceBtn');
                const printBtn = document.getElementById('printAttendanceBtn');
                
                if (saveBtn) {
                    saveBtn.addEventListener('click', () => this.saveAttendance());
                }
                
                if (printBtn) {
                    printBtn.addEventListener('click', () => this.printAttendance());
                }
            }

            setupReportEventListeners() {
                const filterBtn = document.getElementById('filterReportBtn');
                const exportPDFBtn = document.getElementById('exportPDFBtn');
                const exportExcelBtn = document.getElementById('exportExcelBtn');
                const exportRegisterBtn = document.getElementById('exportRegisterBtn');
                
                if (filterBtn) {
                    filterBtn.addEventListener('click', () => this.filterReports());
                }
                
                if (exportPDFBtn) {
                    exportPDFBtn.addEventListener('click', () => this.exportReportPDF());
                }
                
                if (exportExcelBtn) {
                    exportExcelBtn.addEventListener('click', () => this.exportReportExcel());
                }
                
                if (exportRegisterBtn) {
                    exportRegisterBtn.addEventListener('click', () => this.exportRegisterPDF());
                }
            }

            populateSubjects(classId) {
                const subjectSelect = document.getElementById('subjectSelect');
                if (!subjectSelect) return;
                
                subjectSelect.innerHTML = '<option value="">-- Select Subject --</option>';
                
                if (!classId) return;
                
                const classObj = this.data.classes.find(c => c.id === classId);
                if (!classObj) return;
                
                classObj.subjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    subjectSelect.appendChild(option);
                });
            }

            populateAttendanceTable(classId) {
                const tableBody = document.getElementById('attendanceTableBody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                
                if (!classId) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="4" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                                <i class="fas fa-users text-4xl text-gray-300 mb-3"></i>
                                <p>Please select a class to view students</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                const students = this.data.students.filter(s => s.classId === classId);
                
                if (students.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="4" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                                <i class="fas fa-user-plus text-4xl text-gray-300 mb-3"></i>
                                <p>No students found in this class</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                students.forEach(student => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition';
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${student.rollNo}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${student.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="status-badge px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">
                                Absent
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" data-student-id="${student.id}" class="attendance-checkbox rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300 select-none">Present</span>
                            </label>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
                
                // Add event listeners to checkboxes
                document.querySelectorAll('.attendance-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const statusBadge = e.target.closest('tr').querySelector('.status-badge');
                        if (e.target.checked) {
                            statusBadge.textContent = 'Present';
                            statusBadge.className = 'status-badge px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';
                        } else {
                            statusBadge.textContent = 'Absent';
                            statusBadge.className = 'status-badge px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200';
                        }
                    });
                });
            }

            selectAttendanceMethod(method) {
                // Remove active state from all buttons
                document.querySelectorAll('.attendance-method-btn').forEach(btn => {
                    btn.classList.remove('border-blue-500', 'border-green-500', 'border-purple-500', 'border-yellow-500');
                    btn.classList.add('border-transparent');
                });

                // Add active state to selected button
                const selectedBtn = document.querySelector(`[data-method="${method}"]`);
                if (selectedBtn) {
                    const colorMap = {
                        manual: 'border-blue-500',
                        qr: 'border-green-500',
                        face: 'border-purple-500',
                        biometric: 'border-yellow-500'
                    };
                    selectedBtn.classList.add(colorMap[method]);
                    selectedBtn.classList.remove('border-transparent');
                }

                // Handle method-specific actions
                switch (method) {
                    case 'qr':
                        this.showModal('qrScannerModal');
                        break;
                    case 'face':
                        this.showModal('faceRecognitionModal');
                        break;
                    case 'biometric':
                        this.showModal('biometricModal');
                        break;
                    case 'manual':
                    default:
                        // Manual method is default, no additional action needed
                        break;
                }
            }

            markAllAttendance(isPresent) {
                document.querySelectorAll('.attendance-checkbox').forEach(checkbox => {
                    checkbox.checked = isPresent;
                    checkbox.dispatchEvent(new Event('change'));
                });
            }

            saveAttendance() {
                const classId = parseInt(document.getElementById('classSelect').value);
                const date = document.getElementById('attendanceDate').value;
                const subject = document.getElementById('subjectSelect').value;
                
                if (!classId || !date || !subject) {
                    this.showNotification('Please select class, date and subject', 'error');
                    return;
                }
                
                const checkboxes = document.querySelectorAll('.attendance-checkbox');
                if (checkboxes.length === 0) {
                    this.showNotification('No students found for this class', 'error');
                    return;
                }
                
                const records = [];
                checkboxes.forEach(checkbox => {
                    records.push({
                        studentId: parseInt(checkbox.dataset.studentId),
                        status: checkbox.checked ? 'present' : 'absent',
                        timestamp: new Date(),
                        method: 'manual'
                    });
                });
                
                // Check if attendance already exists
                const existingIndex = this.data.attendance.findIndex(a => 
                    a.classId === classId && 
                    a.date === date && 
                    a.subject === subject
                );
                
                if (existingIndex >= 0) {
                    // Update existing record
                    this.data.attendance[existingIndex].records = records;
                    this.data.attendance[existingIndex].updatedAt = new Date();
                } else {
                    // Add new record
                    const newId = this.data.attendance.length > 0 ? 
                        Math.max(...this.data.attendance.map(a => a.id)) + 1 : 1;
                    
                    this.data.attendance.push({
                        id: newId,
                        classId,
                        date,
                        subject,
                        period: 1,
                        teacherId: this.currentUser.id,
                        records,
                        method: 'manual',
                        createdAt: new Date(),
                        updatedAt: new Date()
                    });
                }
                
                this.saveToStorage();
                this.showNotification('Attendance saved successfully', 'success');
            }

            printAttendance() {
                const classId = parseInt(document.getElementById('classSelect').value);
                const date = document.getElementById('attendanceDate').value;
                const subject = document.getElementById('subjectSelect').value;
                
                if (!classId || !date || !subject) {
                    this.showNotification('Please select class, date and subject', 'error');
                    return;
                }
                
                const classObj = this.data.classes.find(c => c.id === classId);
                const students = this.data.students.filter(s => s.classId === classId);
                
                if (students.length === 0) {
                    this.showNotification('No students found in this class', 'error');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(20);
                doc.text('Attendance Report', 105, 20, { align: 'center' });
                
                doc.setFontSize(12);
                doc.text(`Class: ${classObj.name}`, 20, 35);
                doc.text(`Subject: ${subject}`, 20, 45);
                doc.text(`Date: ${date}`, 20, 55);
                doc.text(`Institution: ${this.data.settings.institutionName}`, 20, 65);
                
                // Attendance table
                const tableData = students.map(student => {
                    const checkbox = document.querySelector(`input[data-student-id="${student.id}"]`);
                    const status = checkbox && checkbox.checked ? 'Present' : 'Absent';
                    return [student.rollNo, student.name, status];
                });
                
                doc.autoTable({
                    head: [['Roll No', 'Name', 'Status']],
                    body: tableData,
                    startY: 75,
                    theme: 'grid',
                    headStyles: {
                        fillColor: [59, 130, 246],
                        textColor: 255
                    },
                    styles: {
                        fontSize: 10
                    }
                });
                
                // Summary
                const presentCount = students.filter(student => {
                    const checkbox = document.querySelector(`input[data-student-id="${student.id}"]`);
                    return checkbox && checkbox.checked;
                }).length;
                
                const finalY = doc.lastAutoTable.finalY + 20;
                doc.setFontSize(12);
                doc.text(`Total Students: ${students.length}`, 20, finalY);
                doc.text(`Present: ${presentCount}`, 20, finalY + 10);
                doc.text(`Absent: ${students.length - presentCount}`, 20, finalY + 20);
                doc.text(`Attendance Rate: ${Math.round((presentCount / students.length) * 100)}%`, 20, finalY + 30);
                
                doc.save(`Attendance_${classObj.name.replace(/\s+/g, '_')}_${date}.pdf`);
                this.showNotification('PDF generated successfully', 'success');
            }

            setDefaultDateRange() {
                const today = new Date();
                const thirtyDaysAgo = new Date(today);
                thirtyDaysAgo.setDate(today.getDate() - 30);
                
                const fromDateInput = document.getElementById('fromDate');
                const toDateInput = document.getElementById('toDate');
                
                if (fromDateInput) fromDateInput.value = this.formatDate(thirtyDaysAgo);
                if (toDateInput) toDateInput.value = this.formatDate(today);
            }

            filterReports() {
                // This would filter the reports table based on selected criteria
                this.showNotification('Reports filtered successfully', 'success');
            }

            exportReportPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(18);
                doc.text('Attendance Report', 105, 20, { align: 'center' });
                
                doc.setFontSize(12);
                const fromDate = document.getElementById('fromDate')?.value || '';
                const toDate = document.getElementById('toDate')?.value || '';
                
                doc.text(`Period: ${fromDate} to ${toDate}`, 20, 35);
                doc.text(`Institution: ${this.data.settings.institutionName}`, 20, 45);
                
                // Get recent records for demo
                const recentRecords = this.data.attendance
                    .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
                    .slice(0, 10);
                
                const tableData = recentRecords.map(record => {
                    const classObj = this.data.classes.find(c => c.id === record.classId);
                    const presentCount = record.records.filter(r => r.status === 'present' || r.status === 'late').length;
                    const absentCount = record.records.length - presentCount;
                    const percentage = record.records.length > 0 ? 
                        Math.round((presentCount / record.records.length) * 100) : 0;
                    
                    return [
                        record.date,
                        classObj ? classObj.name : 'Unknown',
                        record.subject,
                        presentCount,
                        absentCount,
                        `${percentage}%`
                    ];
                });
                
                doc.autoTable({
                    head: [['Date', 'Class', 'Subject', 'Present', 'Absent', 'Rate']],
                    body: tableData,
                    startY: 55,
                    theme: 'grid',
                    headStyles: {
                        fillColor: [59, 130, 246],
                        textColor: 255
                    },
                    styles: {
                        fontSize: 9
                    }
                });
                
                doc.save(`Attendance_Report_${fromDate}_to_${toDate}.pdf`);
                this.showNotification('PDF report exported successfully', 'success');
            }

            exportReportExcel() {
                const recentRecords = this.data.attendance
                    .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
                    .slice(0, 10);
                
                const excelData = recentRecords.map(record => {
                    const classObj = this.data.classes.find(c => c.id === record.classId);
                    const presentCount = record.records.filter(r => r.status === 'present' || r.status === 'late').length;
                    const absentCount = record.records.length - presentCount;
                    const percentage = record.records.length > 0 ? 
                        Math.round((presentCount / record.records.length) * 100) : 0;
                    
                    return {
                        'Date': record.date,
                        'Class': classObj ? classObj.name : 'Unknown',
                        'Subject': record.subject,
                        'Present': presentCount,
                        'Absent': absentCount,
                        'Total': record.records.length,
                        'Attendance Rate (%)': percentage
                    };
                });
                
                const ws = XLSX.utils.json_to_sheet(excelData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Attendance Report');
                
                const fromDate = document.getElementById('fromDate')?.value || 'latest';
                const toDate = document.getElementById('toDate')?.value || 'data';
                XLSX.writeFile(wb, `Attendance_Report_${fromDate}_to_${toDate}.xlsx`);
                
                this.showNotification('Excel report exported successfully', 'success');
            }

            exportRegisterPDF() {
                const classId = document.getElementById('reportClassSelect')?.value;
                const classObj = classId ? this.data.classes.find(c => c.id == classId) : this.data.classes[0];
                
                if (!classObj) {
                    this.showNotification('Please select a class', 'error');
                    return;
                }

                const students = this.data.students.filter(s => s.classId === classObj.id);
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('landscape');
                
                // Header
                doc.setFontSize(16);
                doc.text('ATTENDANCE REGISTER', 148, 20, { align: 'center' });
                
                doc.setFontSize(12);
                doc.text(`Class: ${classObj.name}`, 20, 35);
                doc.text(`Institution: ${this.data.settings.institutionName}`, 20, 45);
                doc.text(`Month/Year: ${new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}`, 200, 35);
                
                // Create register table with dates
                const today = new Date();
                const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
                const dates = [];
                for (let i = 1; i <= Math.min(daysInMonth, 31); i++) {
                    dates.push(i.toString());
                }
                
                // Table headers
                const headers = ['S.No', 'Roll No', 'Student Name', ...dates.slice(0, 20), 'Total P', 'Total A', '%'];
                
                // Table data
                const tableData = students.map((student, index) => {
                    const row = [
                        (index + 1).toString(),
                        student.rollNo,
                        student.name
                    ];
                    
                    // Add attendance marks for each day (P/A/L)
                    for (let i = 0; i < 20; i++) {
                        // Mock attendance data for register
                        const random = Math.random();
                        if (random > 0.85) row.push('A');
                        else if (random > 0.95) row.push('L');
                        else row.push('P');
                    }
                    
                    // Calculate totals
                    const presentDays = row.slice(3, 23).filter(mark => mark === 'P' || mark === 'L').length;
                    const absentDays = row.slice(3, 23).filter(mark => mark === 'A').length;
                    const percentage = Math.round((presentDays / 20) * 100);
                    
                    row.push(presentDays.toString(), absentDays.toString(), `${percentage}%`);
                    
                    return row;
                });
                
                doc.autoTable({
                    head: [headers],
                    body: tableData,
                    startY: 55,
                    theme: 'grid',
                    headStyles: {
                        fillColor: [59, 130, 246],
                        textColor: 255,
                        fontSize: 8
                    },
                    styles: {
                        fontSize: 7,
                        cellPadding: 2
                    },
                    columnStyles: {
                        0: { cellWidth: 15 },
                        1: { cellWidth: 20 },
                        2: { cellWidth: 40 }
                    }
                });
                
                // Footer
                const finalY = doc.lastAutoTable.finalY + 20;
                doc.setFontSize(10);
                doc.text('Legend: P = Present, A = Absent, L = Late', 20, finalY);
                doc.text(`Teacher Signature: ________________`, 20, finalY + 15);
                doc.text(`Date: ${new Date().toLocaleDateString()}`, 200, finalY + 15);
                
                doc.save(`Attendance_Register_${classObj.name.replace(/\s+/g, '_')}.pdf`);
                this.showNotification('Register PDF exported successfully', 'success');
            }

            // Modal Management
            showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('hidden');
                    setTimeout(() => modal.classList.add('show'), 10);
                }
            }

            closeModal(modal) {
                if (modal) {
                    modal.classList.remove('show');
                    setTimeout(() => modal.classList.add('hidden'), 300);
                }
            }

            // 2FA Methods
            show2FASetup() {
                this.generate2FAQRCode();
                this.showModal('twoFactorModal');
            }

            generate2FAQRCode() {
                const container = document.getElementById('qrCodeContainer');
                if (!container) return;

                const secret = 'JBSWY3DPEHPK3PXP'; // Demo secret
                const qrData = `otpauth://totp/${encodeURIComponent(this.data.settings.institutionName)}:${encodeURIComponent(this.currentUser.email)}?secret=${secret}&issuer=${encodeURIComponent(this.data.settings.institutionName)}`;
                
                QRCode.toCanvas(qrData, { width: 200, margin: 2 }, (error, canvas) => {
                    if (error) {
                        console.error('QR Code generation failed:', error);
                        return;
                    }
                    
                    container.innerHTML = '';
                    container.appendChild(canvas);
                });
            }

            verify2FA() {
                const code = document.getElementById('verify2FACode').value;
                
                if (code === '123456') {
                    this.currentUser.is2FAEnabled = true;
                    this.saveToStorage();
                    this.showNotification('2FA enabled successfully', 'success');
                    this.closeModal(document.getElementById('twoFactorModal'));
                    this.updateUserInfo();
                } else {
                    this.showNotification('Invalid verification code', 'error');
                }
            }

            // Scanner Methods
            startQRScanner() {
                this.showNotification('QR Scanner started (Demo mode)', 'info');
                
                // Simulate QR scan success after 3 seconds
                setTimeout(() => {
                    this.showNotification('Attendance marked successfully via QR code', 'success');
                    this.closeModal(document.getElementById('qrScannerModal'));
                }, 3000);
            }

            startFaceRecognition() {
                this.showNotification('Face recognition started (Demo mode)', 'info');
                
                // Simulate face recognition success after 4 seconds
                setTimeout(() => {
                    this.showNotification('Face recognized - Attendance marked successfully', 'success');
                    this.closeModal(document.getElementById('faceRecognitionModal'));
                }, 4000);
            }

            startBiometricScan() {
                this.showNotification('Biometric scanner activated (Demo mode)', 'info');
                
                // Simulate biometric scan success after 3 seconds
                setTimeout(() => {
                    this.showNotification('Fingerprint verified - Attendance marked successfully', 'success');
                    this.closeModal(document.getElementById('biometricModal'));
                }, 3000);
            }

            enableGPS() {
                this.showNotification('Requesting location access...', 'info');
                
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const { latitude, longitude } = position.coords;
                            document.getElementById('currentLocation').textContent = `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
                            document.getElementById('distanceFromSchool').textContent = '0.2 km';
                            document.getElementById('locationInfo').classList.remove('hidden');
                            
                            this.showNotification('Location verified - Attendance marked successfully', 'success');
                            setTimeout(() => {
                                this.closeModal(document.getElementById('gpsModal'));
                            }, 2000);
                        },
                        (error) => {
                            this.showNotification('Location access denied or unavailable', 'error');
                        }
                    );
                } else {
                    this.showNotification('Geolocation is not supported by this browser', 'error');
                }
            }

            // Theme and Language Management
            toggleThemeMenu() {
                const menu = document.getElementById('themeMenu');
                menu.classList.toggle('hidden');
            }

            toggleLanguageMenu() {
                const menu = document.getElementById('languageMenu');
                menu.classList.toggle('hidden');
            }

            toggleUserMenu() {
                const menu = document.getElementById('userMenu');
                menu.classList.toggle('hidden');
            }

            setTheme(theme) {
                this.currentTheme = theme;
                this.applyTheme();
                this.saveToStorage();
                document.getElementById('themeMenu').classList.add('hidden');
            }

            setLanguage(language) {
                this.currentLanguage = language;
                this.saveToStorage();
                this.renderNavigation();
                this.renderContent(this.currentSection);
                document.getElementById('languageMenu').classList.add('hidden');
                this.showNotification(`Language changed to ${this.getLanguageName(language)}`, 'success');
            }

            getLanguageName(code) {
                const names = {
                    en: 'English',
                    es: 'Espa√±ol',
                    fr: 'Fran√ßais',
                    de: 'Deutsch',
                    hi: '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä',
                    ar: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©'
                };
                return names[code] || 'English';
            }

            applyTheme() {
                const root = document.documentElement;
                root.classList.remove('light', 'dark');
                
                if (this.currentTheme === 'system') {
                    const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                    root.classList.add(systemTheme);
                } else {
                    root.classList.add(this.currentTheme);
                }

                // Update theme icon
                const themeIcon = document.getElementById('themeIcon');
                if (themeIcon) {
                    const iconClass = this.currentTheme === 'dark' ? 'fas fa-moon' : 
                                     this.currentTheme === 'light' ? 'fas fa-sun' : 'fas fa-desktop';
                    themeIcon.className = iconClass + ' w-5 h-5';
                }
            }

            translate(key) {
                return this.translations[this.currentLanguage]?.[key] || this.translations.en[key] || key;
            }

            // Mobile and Sidebar Management
            toggleMobileMenu() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('active');
            }

            closeMobileMenu() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.remove('active');
            }

            toggleSidebar() {
                this.sidebarCollapsed = !this.sidebarCollapsed;
                this.updateSidebarState();
                this.saveToStorage();
            }

            updateSidebarState() {
                const sidebar = document.getElementById('sidebar');
                const collapseBtn = document.getElementById('collapseSidebarBtn');
                const sidebarTitle = document.getElementById('sidebarTitle');
                const navTexts = document.querySelectorAll('.nav-text');
                const userInfo = document.getElementById('userInfo');

                if (this.sidebarCollapsed) {
                    sidebar.classList.add('collapsed');
                    if (collapseBtn) collapseBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
                    if (sidebarTitle) sidebarTitle.style.display = 'none';
                    navTexts.forEach(text => text.style.display = 'none');
                    if (userInfo) userInfo.style.display = 'none';
                } else {
                    sidebar.classList.remove('collapsed');
                    if (collapseBtn) collapseBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
                    if (sidebarTitle) sidebarTitle.style.display = 'block';
                    navTexts.forEach(text => text.style.display = 'inline');
                    if (userInfo) userInfo.style.display = 'block';
                }
            }

            // Utility Methods
            updateTime() {
                const updateClock = () => {
                    const now = new Date();
                    const timeString = now.toLocaleTimeString('en-US', {
                        hour12: true,
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                    
                    const timeElement = document.getElementById('currentTime');
                    if (timeElement) {
                        timeElement.textContent = timeString;
                    }
                };

                updateClock();
                setInterval(updateClock, 1000);
            }

            formatDate(date, withDay = false) {
                const d = new Date(date);
                if (withDay) {
                    return d.toLocaleDateString('en-US', {
                        weekday: 'short',
                        month: 'short',
                        day: 'numeric'
                    });
                } else {
                    return d.toISOString().split('T')[0];
                }
            }

            showNotification(message, type = 'success') {
                const notification = document.getElementById(`${type}Notification`);
                const messageElement = document.getElementById(`${type}Message`);
                
                if (notification && messageElement) {
                    messageElement.textContent = message;
                    notification.classList.add('show');
                    
                    setTimeout(() => {
                        notification.classList.remove('show');
                    }, 4000);
                }
            }

            showNotifications() {
                this.showSection('notifications');
            }

            handleGlobalSearch(query) {
                if (query.length < 2) return;
                
                // Simple search implementation
                console.log('Searching for:', query);
                // In a real app, this would search through students, classes, etc.
            }

            handleOutsideClick(e) {
                // Close dropdowns when clicking outside
                const dropdowns = ['themeMenu', 'languageMenu', 'userMenu'];
                dropdowns.forEach(id => {
                    const menu = document.getElementById(id);
                    const button = document.getElementById(id.replace('Menu', 'Btn'));
                    
                    if (menu && button && !menu.contains(e.target) && !button.contains(e.target)) {
                        menu.classList.add('hidden');
                    }
                });

                // Close mobile sidebar when clicking outside
                const sidebar = document.getElementById('sidebar');
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                
                if (window.innerWidth < 768 && 
                    sidebar && mobileMenuBtn &&
                    !sidebar.contains(e.target) && 
                    !mobileMenuBtn.contains(e.target) && 
                    sidebar.classList.contains('active')) {
                    this.closeMobileMenu();
                }
            }

            handleKeyboardShortcuts(e) {
                // Keyboard shortcuts
                if (e.ctrlKey || e.metaKey) {
                    switch (e.key) {
                        case 'k':
                            e.preventDefault();
                            document.getElementById('globalSearch').focus();
                            break;
                        case '1':
                            e.preventDefault();
                            this.showSection('dashboard');
                            break;
                        case '2':
                            e.preventDefault();
                            if (this.currentUser.role === 'admin' || this.currentUser.role === 'teacher') {
                                this.showSection('attendance');
                            }
                            break;
                        case 'Escape':
                            // Close any open modals
                            document.querySelectorAll('.modal.show').forEach(modal => {
                                this.closeModal(modal);
                            });
                            break;
                    }
                }
            }
        }

        // Initialize the application
        const app = new AttendanceApp();
    </script>
</body>
</html>